<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>React简单pc项目 | pupu's blog</title><meta name="author" content="pupu"><meta name="copyright" content="pupu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="笔记链接：语雀视频： 1. 项目前置准备1. 项目介绍本节目标:  了解项目的定位和功能 项目功能演示   登录、退出   token的使用   antd的使用与自定制主题   首页   内容（文章）管理：文章列表、发布文章、修改文章  技术   React 官方脚手架 create-react-app   react hooks   状态管理：mobx   UI 组件库：antd v4   aj">
<meta property="og:type" content="article">
<meta property="og:title" content="React简单pc项目">
<meta property="og:url" content="http://example.com/2023/06/06/React%E7%AE%80%E5%8D%95pc%E9%A1%B9%E7%9B%AE/index.html">
<meta property="og:site_name" content="pupu&#39;s blog">
<meta property="og:description" content="笔记链接：语雀视频： 1. 项目前置准备1. 项目介绍本节目标:  了解项目的定位和功能 项目功能演示   登录、退出   token的使用   antd的使用与自定制主题   首页   内容（文章）管理：文章列表、发布文章、修改文章  技术   React 官方脚手架 create-react-app   react hooks   状态管理：mobx   UI 组件库：antd v4   aj">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/img.jpg">
<meta property="article:published_time" content="2023-06-06T11:40:27.000Z">
<meta property="article:modified_time" content="2023-06-06T11:41:30.015Z">
<meta property="article:author" content="pupu">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/img.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/06/06/React%E7%AE%80%E5%8D%95pc%E9%A1%B9%E7%9B%AE/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'React简单pc项目',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-06 19:41:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="pupu's blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/img.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="pupu's blog"><span class="site-name">pupu's blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">React简单pc项目</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-06T11:40:27.000Z" title="发表于 2023-06-06 19:40:27">2023-06-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-06T11:41:30.015Z" title="更新于 2023-06-06 19:41:30">2023-06-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE/">前端项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="React简单pc项目"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>笔记链接：<a target="_blank" rel="noopener" href="https://www.yuque.com/fechaichai/tzzlh1">语雀</a><br>视频：</p>
<h1 id="1-项目前置准备"><a href="#1-项目前置准备" class="headerlink" title="1. 项目前置准备"></a>1. 项目前置准备</h1><h2 id="1-项目介绍"><a href="#1-项目介绍" class="headerlink" title="1. 项目介绍"></a>1. 项目介绍</h2><p><code>本节目标:</code>  了解项目的定位和功能</p>
<h3 id="项目功能演示"><a href="#项目功能演示" class="headerlink" title="项目功能演示"></a>项目功能演示</h3><ul>
<li>  登录、退出</li>
<li>  token的使用</li>
<li>  antd的使用与自定制主题</li>
<li>  首页</li>
<li>  内容（文章）管理：文章列表、发布文章、修改文章</li>
</ul>
<h3 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h3><ul>
<li>  React 官方脚手架 <code>create-react-app</code></li>
<li>  react hooks</li>
<li>  状态管理：mobx</li>
<li>  UI 组件库：<code>antd</code> v4</li>
<li>  ajax请求库：<code>axios</code></li>
<li>  路由：<code>react-router-dom</code> 以及 <code>history</code></li>
<li>  富文本编辑器：<code>react-quill</code></li>
<li>  CSS 预编译器：<code>sass</code></li>
</ul>
<h2 id="4-使用scss预处理器"><a href="#4-使用scss预处理器" class="headerlink" title="4. 使用scss预处理器"></a>4. 使用scss预处理器</h2><p><code>本节目标:</code>  能够在CRA中使用sass书写样式</p>
<p><code>SASS</code> 是一种预编译的 CSS，作用类似于 Less。由于 React 中内置了处理 SASS 的配置，所以，在 CRA 创建的项目中，可以直接使用 SASS 来写样式，只需要将sass这个包安装到自己的项目就可以了</p>
<p>之前sass在国内装包容易失败，所以一些公司都会使用less，但React中没有less，需要自己配置。</p>
<p><strong>实现步骤</strong></p>
<ol>
<li> 安装解析 sass 的包：<code>yarn add sass -D</code>(-D 表示只在开发环境依赖)</li>
<li> 创建全局样式文件：<code>index.scss</code></li>
</ol>
<figure class="highlight css"><figcaption><span>index.scss</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#root</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-配置基础路由"><a href="#5-配置基础路由" class="headerlink" title="5. 配置基础路由"></a>5. 配置基础路由</h2><p><code>本节目标:</code> 能够配置登录页面的路由并显示到页面中</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 安装路由：<code>yarn add react-router-dom</code></p>
</li>
<li><p> 在 pages 目录中创建两个文件夹：Login、Layout</p>
</li>
<li><p> 分别在两个目录中创建 index.js 文件，并创建一个简单的组件后导出</p>
</li>
<li><p> 在 App 组件中，导入路由组件以及两个页面组件</p>
</li>
<li><p> 配置 Login 和 Layout 的路由规则</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>pages/Login/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Login</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>login<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Login</span></span><br></pre></td></tr></table></figure>

<p>pages/Layout/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Layout</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>layout<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Layout</span></span><br></pre></td></tr></table></figure>

<p>app.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入路由</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span>, <span class="title class_">Route</span>, <span class="title class_">Routes</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入页面组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Login</span> <span class="keyword">from</span> <span class="string">&#x27;./pages/Login&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&#x27;./pages/Layout&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由规则</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Layout</span>/&gt;</span>&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Login</span>/&gt;</span>&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>

<h2 id="6-组件库antd使用"><a href="#6-组件库antd使用" class="headerlink" title="6. 组件库antd使用"></a>6. 组件库antd使用</h2><p><code>本节目标:</code>  能够使用antd的Button组件渲染按钮</p>
<p><strong>实现步骤</strong></p>
<ol>
<li> 安装 antd 组件库：<code>yarn add antd</code></li>
<li> 全局导入 antd 组件库的样式</li>
<li> 导入 Button 组件</li>
<li> 在 Login 页面渲染 Button 组件进行测试</li>
</ol>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p><a target="_blank" rel="noopener" href="https://www.yuque.com/ant-design/ant-design/cy5nfvdo8oidvwmz#swQzv">AntDesign 5.0 官网</a></p>
<ul>
<li><p>  第二步教程里写的是导入<code>import &#39;antd/dist/antd.min.css&#39;</code>,但antd5.0已经没有这个文件了，不需要导入全局样式。antd5 采用的是CSSINJS，动态根据需要引入样式，不需要再单独引入css文件。</p>
</li>
<li><p>  可以导入<code>import &#39;antd/dist/reset.css&#39;</code>来重置全局样式，避免某些浏览器默认css设置不同</p>
</li>
</ul>
<h3 id="antd如何使用自己的主题色"><a href="#antd如何使用自己的主题色" class="headerlink" title="antd如何使用自己的主题色"></a>antd如何使用自己的主题色</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/HYHhmbb/article/details/126608454">修改主题色的参考链接</a></p>
<p>antd 4与5不同，5修改全局颜色比较简单</p>
<p><a target="_blank" rel="noopener" href="https://ant.design/components/config-provider-cn#components-config-provider-demo-theme">ant5如何进行全局化配置</a><br><a target="_blank" rel="noopener" href="https://ant.design/docs/react/customize-theme-cn#%E4%B8%BB%E9%A2%98%E5%B1%95%E7%A4%BA">ant5 定制主题</a></p>
<p><strong>代码实现</strong></p>
<p><code>src/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先导入 antd 样式文件</span></span><br><span class="line"><span class="comment">// https://github.com/ant-design/ant-design/issues/33327</span></span><br><span class="line"><span class="comment">// 导入antd.min.css 而不是antd.css是因为antd 5会有一个警告</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;antd/dist/antd.min.css&#x27;</span></span><br><span class="line"><span class="comment">// 再导入全局样式文件，防止样式覆盖！</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>pages/Login/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Login</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>Button<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="7-配置别名路径"><a href="#7-配置别名路径" class="headerlink" title="7. 配置别名路径"></a>7. 配置别名路径</h2><p><code>本节目标:</code>  能够配置@路径简化路径处理</p>
<blockquote>
<p>本质还是配置webpack</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://ant.design/docs/react/use-with-create-react-app-cn#%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE">自定义 CRA 的默认配置</a><br><a target="_blank" rel="noopener" href="https://github.com/gsoft-inc/craco/blob/master/packages/craco/README.md#configuration">craco 配置文档</a></p>
<ul>
<li><p>  CRA 将所有工程化配置，都隐藏在了 <code>react-scripts</code> 包中，所以项目中看不到任何配置信息</p>
</li>
<li><p>如果要修改 CRA 的默认配置，有以下几种方案：</p>
<ol>
<li><p> 通过第三方库来修改，比如，<code>@craco/craco</code>  （推荐）</p>
</li>
<li><p> 通过执行 <code>yarn eject</code> 命令，释放 <code>react-scripts</code> 中的所有配置到项目中</p>
</li>
</ol>
</li>
</ul>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 安装修改 CRA 配置的包：<code>yarn add -D @craco/craco</code></p>
</li>
<li><p> 在项目根目录中创建 craco 的配置文件：<code>craco.config.js</code>，并在配置文件中配置路径别名</p>
</li>
<li><p> 修改 <code>package.json</code> 中的脚本命令</p>
</li>
<li><p> 在代码中，就可以通过 <code>@</code> 来表示 src 目录的绝对路径</p>
</li>
<li><p> 重启项目，让配置生效</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>craco.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// webpack 配置</span></span><br><span class="line">  <span class="attr">webpack</span>: &#123;</span><br><span class="line">    <span class="comment">// 配置别名</span></span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="comment">// 约定：使用 @ 表示 src 文件所在路径</span></span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 start/build/test 三个命令修改为 craco 方式</span></span><br><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;craco start&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;craco build&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;craco test&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;eject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-scripts eject&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="8-别名路径提示"><a href="#8-别名路径提示" class="headerlink" title="8. @别名路径提示"></a>8. @别名路径提示</h2><p><code>本节目标:</code>  能够让vscode识别@路径并给出路径提示</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 在项目根目录创建 <code>jsconfig.json</code> 配置文件</p>
</li>
<li><p> 在配置文件中添加以下配置</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;@/*&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/*&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>vscode会自动读取<code>jsconfig.json</code> 中的配置，让vscode知道@就是src目录</p>
<h2 id="9-安装dev-tools调试工具"><a href="#9-安装dev-tools调试工具" class="headerlink" title="9. 安装dev-tools调试工具"></a>9. 安装dev-tools调试工具</h2><p><a target="_blank" rel="noopener" href="https://gitee.com/react-cp/react-pc-doc">https://gitee.com/react-cp/react-pc-doc</a>  这里找到dev-tools.crx文件</p>
<h1 id="2-登录模块"><a href="#2-登录模块" class="headerlink" title="2. 登录模块"></a>2. 登录模块</h1><h2 id="1-基本结构搭建"><a href="#1-基本结构搭建" class="headerlink" title="1. 基本结构搭建"></a>1. 基本结构搭建</h2><p>本节目标:  能够使用antd搭建基础布局</p>
<p>实现步骤<br>1在 Login/index.js 中创建登录页面基本结构<br>2在 Login 目录中创建 index.scss 文件，指定组件样式<br>3将 logo.png 和 login.png 拷贝到 assets 目录中</p>
<p>代码实现<br>pages/Login/index.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Card</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">&#x27;@/assets/logo.png&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Login</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Card</span> <span class="attr">className</span>=<span class="string">&quot;login-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">className</span>=<span class="string">&quot;login-logo&quot;</span> <span class="attr">src</span>=<span class="string">&#123;logo&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;/* 登录表单 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Login</span></span><br></pre></td></tr></table></figure>

<p>pages/Login/index.scss</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.login</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background</span>: center/cover <span class="built_in">url</span>(<span class="string">&#x27;~@/assets/login.png&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.login-logo</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">60px</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto <span class="number">20px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.login-container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">440px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">360px</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">50px</span> <span class="built_in">rgb</span>(<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> / <span class="number">10%</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.login-checkbox-label</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#1890ff</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-创建表单结构"><a href="#2-创建表单结构" class="headerlink" title="2. 创建表单结构"></a>2. 创建表单结构</h2><p><code>本节目标:</code> 能够使用antd的Form组件创建登录表单</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 打开 antd <a target="_blank" rel="noopener" href="https://ant.design/components/form-cn/">Form 组件文档</a></p>
</li>
<li><p> 找到代码演示的第一个示例（基本使用），点击<code>&lt;&gt;</code>（显示代码），并拷贝代码到组件中</p>
</li>
<li><p> 分析 Form 组件基本结构</p>
</li>
<li><p> 调整 Form 组件结构和样式</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>pages/Login/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Form</span>, <span class="title class_">Input</span>, <span class="title class_">Button</span>, <span class="title class_">Checkbox</span> , <span class="title class_">Card</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.scss&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Login</span> ()&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Card</span> <span class="attr">className</span>=<span class="string">&quot;login-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;login-font&#x27;</span>&gt;</span>账号登录<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">Input</span> <span class="attr">size</span>=<span class="string">&#x27;large&#x27;</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入手机号&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">Input</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">Input</span> <span class="attr">size</span>=<span class="string">&#x27;large&#x27;</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入验证码&#x27;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Form.Item</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">Checkbox</span> <span class="attr">className</span>=<span class="string">&#x27;login-checkbox-label&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            我已阅读并同意「用户协议」和「隐私条款」</span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">Checkbox</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">htmlType</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">block</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            登录</span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span>            </span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Login</span></span><br></pre></td></tr></table></figure>

<h2 id="3-表单校验实现"><a href="#3-表单校验实现" class="headerlink" title="3. 表单校验实现"></a>3. 表单校验实现</h2><p><code>本节目标:</code> 能够为手机号和密码添加表单校验</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 为 Form 组件添加 <code>validateTrigger</code> 属性，指定校验触发时机的集合（validateTrigger 设置字段校验的时机，默认值是 onchange）</p>
</li>
<li><p> <strong>为 Form.Item 组件添加 name 属性，这样表单校验才会生效 [容易忽略]</strong></p>
</li>
</ol>
<blockquote>
<p>被设置了 <code>name</code> 属性的 <code>Form.Item</code> 包装的控件，表单控件会自动添加 <code>value</code>（或 <code>valuePropName</code> 指定的其他属性） <code>onChange</code>（或 <code>trigger</code> 指定的其他属性），数据同步将被 Form 接管，这会导致以下结果：</p>
</blockquote>
<blockquote>
<ol>
<li> 你<strong>不再需要也不应该</strong>用 <code>onChange</code> 来做数据收集同步（你可以使用 Form 的 <code>onValuesChange</code>），但还是可以继续监听 <code>onChange</code> 事件。</li>
<li> 你不能用控件的 <code>value</code> 或 <code>defaultValue</code> 等属性来设置表单域的值，默认值可以用 Form 里的 <code>initialValues</code> 来设置。注意 <code>initialValues</code> 不能被 <code>setState</code> 动态更新，你需要用 <code>setFieldsValue</code> 来更新。</li>
<li> 你不应该用 <code>setState</code>，可以使用 <code>form.setFieldsValue</code> 来动态改变表单值。</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li> 为 Form.Item 组件添加 <code>rules</code> 属性，用来添加表单校验</li>
</ol>
</blockquote>
<p><strong>代码实现</strong></p>
<p><code>page/Login/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Login</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">validateTrigger</span>=<span class="string">&#123;[</span>&#x27;<span class="attr">onBlur</span>&#x27;, &#x27;<span class="attr">onChange</span>&#x27;]&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">name</span>=<span class="string">&quot;mobile&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">pattern:</span> /^<span class="attr">1</span>[<span class="attr">3-9</span>]\<span class="attr">d</span>&#123;<span class="attr">9</span>&#125;$/,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">message:</span> &#x27;<span class="attr">手机号码格式不对</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">validateTrigger:</span> &#x27;<span class="attr">onBlur</span>&#x27;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123; <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">请输入手机号</span>&#x27; &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Input</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入手机号&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">name</span>=<span class="string">&quot;code&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123; <span class="attr">len:</span> <span class="attr">6</span>, <span class="attr">message:</span> &#x27;<span class="attr">验证码6个字符</span>&#x27;, <span class="attr">validateTrigger:</span> &#x27;<span class="attr">onBlur</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123; <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">请输入验证码</span>&#x27; &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Input</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入验证码&quot;</span> <span class="attr">maxLength</span>=<span class="string">&#123;6&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">name</span>=<span class="string">&quot;remember&quot;</span> <span class="attr">valuePropName</span>=<span class="string">&quot;checked&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Checkbox</span> <span class="attr">className</span>=<span class="string">&quot;login-checkbox-label&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          我已阅读并同意「用户协议」和「隐私条款」</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Checkbox</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">htmlType</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">block</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          登录</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-获取登录表单数据"><a href="#4-获取登录表单数据" class="headerlink" title="4. 获取登录表单数据"></a>4. 获取登录表单数据</h2><p><code>本节目标:</code> 能够拿到登录表单中用户的手机号码和验证码</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 为 Form 组件添加 <code>onFinish</code> 属性，该事件会在点击登录按钮时触发。（ <code>onFinish</code>在 提交表单且数据验证成功后回调事件）</p>
</li>
<li><p> 创建 onFinish 函数，通过函数参数 values 拿到表单值</p>
</li>
<li><p> Form 组件添加 <code>initialValues</code> 属性，来初始化表单值</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>pages/Login/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击登录按钮时触发 参数values即是表单输入数据</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onFinish</span> = values =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(values)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="title class_">Form</span></span><br><span class="line">  onFinish=&#123; onFinish &#125;</span><br><span class="line">  initialValues=&#123;&#123;</span><br><span class="line">    <span class="attr">mobile</span>: <span class="string">&#x27;13911111111&#x27;</span>,</span><br><span class="line">    <span class="attr">code</span>: <span class="string">&#x27;246810&#x27;</span>,</span><br><span class="line">    <span class="attr">remember</span>: <span class="literal">true</span></span><br><span class="line">  &#125;&#125;</span><br><span class="line">&gt;...&lt;/<span class="title class_">Form</span>&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5-封装http工具模块"><a href="#5-封装http工具模块" class="headerlink" title="5. 封装http工具模块"></a>5. 封装http工具模块</h2><p><code>本节目标:</code> 封装axios，简化操作</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 首先要安装axios</p>
</li>
<li><p> 创建 utils/http.js 文件</p>
</li>
<li><p> 创建 axios 实例，配置 baseURL，请求拦截器，响应拦截器</p>
</li>
<li><p> 在 utils/index.js 中，统一导出 http</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>utils/http.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;http://geek.itheima.net/v1_0&#x27;</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">http.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">config</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;, <span class="function">(<span class="params">error</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">http.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">response</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 2xx 范围内的状态码都会触发该函数。</span></span><br><span class="line">    <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">  &#125;, <span class="function">(<span class="params">error</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 超出 2xx 范围的状态码都会触发该函数。</span></span><br><span class="line">    <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; http &#125;</span><br></pre></td></tr></table></figure>

<p>utils/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; http &#125; <span class="keyword">from</span> <span class="string">&#x27;./http&#x27;</span></span><br><span class="line"><span class="keyword">export</span> &#123;  http &#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-配置登录Mobx"><a href="#6-配置登录Mobx" class="headerlink" title="6. 配置登录Mobx"></a>6. 配置登录Mobx</h2><p><code>本节目标:</code>  基于mobx封装管理用户登录的store</p>
<ul>
<li>  安装mobx <code>npm add mobx mobx-react-lite</code></li>
</ul>
<p><code>store/login.Store.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; makeAutoObservable &#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; http &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginStore</span> &#123;</span><br><span class="line">  token = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">makeAutoObservable</span>(<span class="variable language_">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 登录</span></span><br><span class="line">  login = <span class="keyword">async</span> (&#123; mobile, code &#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> http.<span class="title function_">post</span>(<span class="string">&#x27;http://geek.itheima.net/v1_0/authorizations&#x27;</span>, &#123;</span><br><span class="line">      mobile,</span><br><span class="line">      code</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">token</span> = res.<span class="property">data</span>.<span class="property">token</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">LoginStore</span></span><br></pre></td></tr></table></figure>

<p>store/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LoginStore</span> <span class="keyword">from</span> <span class="string">&#x27;./login.Store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RootStore</span> &#123;</span><br><span class="line">  <span class="comment">// 组合模块</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">loginStore</span> = <span class="keyword">new</span> <span class="title class_">LoginStore</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 导入useStore方法供组件使用数据</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">StoresContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(<span class="keyword">new</span> <span class="title class_">RootStore</span>())</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">useStore</span> = (<span class="params"></span>) =&gt; <span class="title class_">React</span>.<span class="title function_">useContext</span>(<span class="title class_">StoresContext</span>)</span><br></pre></td></tr></table></figure>

<h2 id="7-实现登录逻辑"><a href="#7-实现登录逻辑" class="headerlink" title="7. 实现登录逻辑"></a>7. 实现登录逻辑</h2><p><code>本节目标:</code>  在表单校验通过之后通过封装好的store调用登录接口</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 使用useStore方法得到loginStore实例对象</p>
</li>
<li><p> 在校验通过之后，调用loginStore中的login函数</p>
</li>
<li><p> 登录成功之后跳转到首页</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Login</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 获取跳转实例对象</span></span><br><span class="line">  <span class="keyword">const</span> navigate = <span class="title function_">useNavigate</span>()</span><br><span class="line">  <span class="keyword">const</span> &#123; loginStore &#125; = <span class="title function_">useStore</span>()</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onFinish</span> = <span class="keyword">async</span> values =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; mobile, code &#125; = values</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> loginStore.<span class="title function_">login</span>(&#123; mobile, code &#125;)</span><br><span class="line">      <span class="title function_">navigate</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      message.<span class="title function_">error</span>(e.<span class="property">response</span>?.<span class="property">data</span>?.<span class="property">message</span> || <span class="string">&#x27;登录失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-token持久化"><a href="#8-token持久化" class="headerlink" title="8. token持久化"></a>8. token持久化</h2><h3 id="封装工具函数"><a href="#封装工具函数" class="headerlink" title="封装工具函数"></a>封装工具函数</h3><p><code>本节目标:</code>  能够统一处理 token 的持久化相关操作</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 创建 utils/token.js 文件</p>
</li>
<li><p> 分别提供 getToken/setToken/clearToken/isAuth 四个工具函数并导出</p>
</li>
<li><p> 创建 utils/index.js 文件，统一导出 token.js 中的所有内容，来简化工具函数的导入</p>
</li>
<li><p> 将登录操作中用到 token 的地方，替换为该工具函数</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>utils/token.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">TOKEN_KEY</span> = <span class="string">&#x27;geek_pc&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getToken</span> = (<span class="params"></span>) =&gt; <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="variable constant_">TOKEN_KEY</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">setToken</span> = token =&gt; <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="variable constant_">TOKEN_KEY</span>, token)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">clearToken</span> = (<span class="params"></span>) =&gt; <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="variable constant_">TOKEN_KEY</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; getToken, setToken, clearToken &#125;</span><br></pre></td></tr></table></figure>

<h3 id="持久化设置"><a href="#持久化设置" class="headerlink" title="持久化设置"></a>持久化设置</h3><p><code>本节目标:</code>  使用token函数持久化配置</p>
<p>React中手动实现token的存取，Vue中会提供相应的插件</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 拿到token的时候一式两份，存本地一份</p>
</li>
<li><p> 初始化的时候优先从本地取，取不到再初始化为空值</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>store/login.Store.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; makeAutoObservable &#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; setToken, getToken, clearToken, http &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginStore</span> &#123;</span><br><span class="line">  <span class="comment">// 这里哦！！</span></span><br><span class="line">  token = <span class="title function_">getToken</span>() || <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">makeAutoObservable</span>(<span class="variable language_">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 登录</span></span><br><span class="line">  login = <span class="keyword">async</span> (&#123; mobile, code &#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> http.<span class="title function_">post</span>(<span class="string">&#x27;http://geek.itheima.net/v1_0/authorizations&#x27;</span>, &#123;</span><br><span class="line">      mobile,</span><br><span class="line">      code</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">token</span> = res.<span class="property">data</span>.<span class="property">token</span></span><br><span class="line">    <span class="comment">// 还有这里哦！！</span></span><br><span class="line">    <span class="title function_">setToken</span>(res.<span class="property">data</span>.<span class="property">token</span>)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">LoginStore</span></span><br></pre></td></tr></table></figure>

<h2 id="9-请求拦截器注入token"><a href="#9-请求拦截器注入token" class="headerlink" title="9. 请求拦截器注入token"></a>9. 请求拦截器注入token</h2><p><code>本节目标:</code> 把token通过请求拦截器注入到请求头中</p>
<p>为什么？因为服务器需要根据token判断请求者是否为合法用户</p>
<p>一处配置，多处生效</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85e1ce3c943c4efda150d909c45e948b~tplv-k3u1fbpfcp-zoom-1.image"><br>拼接方式：config.headers.Authorization = <code>Bearer $&#123;token&#125;&#125;</code></p>
<p><code>utils/http.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// if not login add token</span></span><br><span class="line">  <span class="keyword">const</span> token = <span class="title function_">getToken</span>()</span><br><span class="line">  <span class="keyword">if</span> (token) &#123;</span><br><span class="line">    config.<span class="property">headers</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="10-路由鉴权实现"><a href="#10-路由鉴权实现" class="headerlink" title="10. 路由鉴权实现"></a>10. 路由鉴权实现</h2><p><code>本节目标:</code> 能够实现未登录时访问拦截并跳转到登录页面</p>
<p><strong>实现思路</strong></p>
<p>自己封装 <code>AuthRoute</code> 路由鉴权高阶组件，实现未登录拦截，并跳转到登录页面</p>
<p>思路为：判断本地是否有token，如果有，就返回子组件，否则就重定向到登录Login</p>
<h3 id="高阶组件"><a href="#高阶组件" class="headerlink" title="高阶组件"></a>高阶组件</h3><p>高阶组件:把一个组件当成另外一个组件的参数传入 然后通过一定的判断 返回新的组件</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 在 components 目录中，创建 AuthRoute/index.js 文件</p>
</li>
<li><p> 判断是否登录</p>
</li>
<li><p> 登录时，直接渲染相应页面组件</p>
</li>
<li><p> 未登录时，重定向到登录页面</p>
</li>
<li><p> 将需要鉴权的页面路由配置，替换为 AuthRoute 组件渲染</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>components/AuthRoute/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 判断token是否存在</span></span><br><span class="line"><span class="comment">// 2. 如果存在 直接正常渲染</span></span><br><span class="line"><span class="comment">// 3. 如果不存在 重定向到登录路由</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 高阶组件:把一个组件当成另外一个组件的参数传入 然后通过一定的判断 返回新的组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Navigate</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">AuthRoute</span> (&#123; children &#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> isToken = <span class="title function_">getToken</span>()</span><br><span class="line">  <span class="keyword">if</span> (isToken) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;children&#125;<span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">replace</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt;AuthComponent&gt; &lt;Layout/&gt; &lt;/AuthComponent&gt;</span></span><br><span class="line"><span class="comment">// 登录：&lt;&gt;&lt;Layout/&gt;&lt;/&gt;</span></span><br><span class="line"><span class="comment">// 非登录：&lt;Navigate to=&quot;/login&quot; replace /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">AuthRoute</span> &#125;</span><br></pre></td></tr></table></figure>

<p>src/app.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Router</span>, <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AuthRoute</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/components/AuthRoute&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&#x27;@/pages/Layout&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Login</span> <span class="keyword">from</span> <span class="string">&#x27;@/pages/Login&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;/* 需要鉴权的路由 */&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/*&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &lt;<span class="attr">AuthRoute</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Layout</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">AuthRoute</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#125; /&gt;</span></span><br><span class="line"><span class="language-xml">          &#123;/* 不需要鉴权的路由 */&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/login&#x27;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Login</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>

<h3 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h3><p>注意高阶组件中使用children的时候要加上 <code>&#123;&#125;</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">AuthRoute</span> (&#123; children &#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> isToken = <span class="title function_">getToken</span>()</span><br><span class="line">  <span class="keyword">if</span> (isToken) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;children&#125;<span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">replace</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-Layout模块"><a href="#3-Layout模块" class="headerlink" title="3. Layout模块"></a>3. Layout模块</h1><h2 id="1-基本结构搭建-1"><a href="#1-基本结构搭建-1" class="headerlink" title="1. 基本结构搭建"></a>1. 基本结构搭建</h2><p>本节目标:  能够使用antd搭建基础布局</p>
<p>实现步骤<br>1打开 antd/Layout 布局组件文档，找到示例：顶部-侧边布局-通栏<br>2拷贝示例代码到我们的 Layout 页面中<br>3分析并调整页面布局</p>
<p>代码实现<br>pages/Layout/index.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Layout</span>, <span class="title class_">Menu</span>, <span class="title class_">Popconfirm</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">HomeOutlined</span>,</span><br><span class="line">  <span class="title class_">DiffOutlined</span>,</span><br><span class="line">  <span class="title class_">EditOutlined</span>,</span><br><span class="line">  <span class="title class_">LogoutOutlined</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Header</span>, <span class="title class_">Sider</span> &#125; = <span class="title class_">Layout</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">GeekLayout</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Header</span> <span class="attr">className</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;logo&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;user-info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;user-name&quot;</span>&gt;</span>user.name<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;user-logout&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Popconfirm</span> <span class="attr">title</span>=<span class="string">&quot;是否确认退出？&quot;</span> <span class="attr">okText</span>=<span class="string">&quot;退出&quot;</span> <span class="attr">cancelText</span>=<span class="string">&quot;取消&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">LogoutOutlined</span> /&gt;</span> 退出</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Popconfirm</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Sider</span> <span class="attr">width</span>=<span class="string">&#123;200&#125;</span> <span class="attr">className</span>=<span class="string">&quot;site-layout-background&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Menu</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">mode</span>=<span class="string">&quot;inline&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">theme</span>=<span class="string">&quot;dark&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">defaultSelectedKeys</span>=<span class="string">&#123;[</span>&#x27;<span class="attr">1</span>&#x27;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">height:</span> &#x27;<span class="attr">100</span>%&#x27;, <span class="attr">borderRight:</span> <span class="attr">0</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">HomeOutlined</span> /&gt;</span>&#125; key=&quot;1&quot;&gt;</span></span><br><span class="line"><span class="language-xml">              数据概览</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DiffOutlined</span> /&gt;</span>&#125; key=&quot;2&quot;&gt;</span></span><br><span class="line"><span class="language-xml">              内容管理</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; key=&quot;3&quot;&gt;</span></span><br><span class="line"><span class="language-xml">              发布文章</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Menu</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Sider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Layout</span> <span class="attr">className</span>=<span class="string">&quot;layout-content&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">padding:</span> <span class="attr">20</span> &#125;&#125;&gt;</span>内容<span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">GeekLayout</span></span><br></pre></td></tr></table></figure>

<p>pages/Layout/index.scss</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.ant-layout</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.logo</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&#x27;~@/assets/logo.png&#x27;</span>) no-repeat center / <span class="number">160px</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.layout-content</span> &#123;</span><br><span class="line">  <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user-info</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.user-name</span> &#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">20px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.user-logout</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ant-layout-header</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-二级路由配置"><a href="#2-二级路由配置" class="headerlink" title="2. 二级路由配置"></a>2. 二级路由配置</h2><p><code>本节目标:</code>  能够在右侧内容区域展示左侧菜单对应的页面内容</p>
<p><strong>使用步骤</strong></p>
<ol>
<li><p> 在 pages 目录中，分别创建：Home（数据概览）/Article（内容管理）/Publish（发布文章）页面文件夹</p>
</li>
<li><p> 分别在三个文件夹中创建 index.js 并创建基础组件后导出</p>
</li>
<li><p> 在app.js中配置嵌套子路由，在layout.js中配置二级路由出口</p>
</li>
<li><p> 使用 Link 修改左侧菜单内容，与子路由规则匹配实现路由切换</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>pages/Home/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Home</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span></span><br></pre></td></tr></table></figure>

<p>pages/Article/index.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Article</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Article<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Article</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Publish</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Publish<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Publish</span></span><br></pre></td></tr></table></figure>

<p>app.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Route</span> path=<span class="string">&quot;/&quot;</span> element=&#123;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">AuthRoute</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Layout</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">AuthRoute</span>&gt;</span></span></span><br><span class="line">  &#125;&gt;</span><br><span class="line">    &#123;<span class="comment">/* 二级路由默认页面 */</span>&#125;</span><br><span class="line">    &lt;<span class="title class_">Route</span> index element=&#123;<span class="language-xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;article&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Article</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;publish&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Publish</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line">&lt;/<span class="title class_">Route</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Login</span>/&gt;</span>&#125;&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>pages/Layout/index.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置Link组件</span></span><br><span class="line">&lt;<span class="title class_">Menu</span></span><br><span class="line">    mode=<span class="string">&quot;inline&quot;</span></span><br><span class="line">    theme=<span class="string">&quot;dark&quot;</span></span><br><span class="line">    style=&#123;&#123; <span class="attr">height</span>: <span class="string">&#x27;100%&#x27;</span>, <span class="attr">borderRight</span>: <span class="number">0</span> &#125;&#125;</span><br><span class="line">    selectedKeys=&#123;[selectedKey]&#125;</span><br><span class="line">    &gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">HomeOutlined</span> /&gt;</span>&#125; key=&quot;/&quot;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>数据概览<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DiffOutlined</span> /&gt;</span>&#125; key=&quot;/article&quot;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/article&quot;</span>&gt;</span>内容管理<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; key=&quot;/publish&quot;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/publish&quot;</span>&gt;</span>发布文章<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Menu</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 二级路由对应显示</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> <span class="attr">className</span>=<span class="string">&quot;layout-content&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">padding:</span> <span class="attr">20</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">  &#123;/* 二级路由默认页面 */&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">Outlet</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="3-菜单高亮显示"><a href="#3-菜单高亮显示" class="headerlink" title="3. 菜单高亮显示"></a>3. 菜单高亮显示</h2><p><code>本节目标:</code>  能够在页面刷新的时候保持对应菜单高亮</p>
<p>页面刷新后，侧边栏的菜单高亮会变为默认的第一个</p>
<p>思路</p>
<ol>
<li><p> Menu组件的selectedKeys属性与Menu.Item组件的key属性发生匹配的时候，Item组件即可高亮</p>
</li>
<li><p> 页面刷新时，将<code>当前访问页面的路由地址</code>作为 Menu 选中项的值（selectedKeys）即可</p>
</li>
</ol>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 将 Menu 的<code>key</code> 属性修改为与其对应的路由地址</p>
</li>
<li><p> 获取到当前正在访问页面的路由地址</p>
</li>
<li><p> 将当前路由地址设置为 <code>selectedKeys</code> 属性的值</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>pages/Layout/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useLocation &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">GeekLayout</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> location = <span class="title function_">useLocation</span>()</span><br><span class="line">  <span class="comment">// 这里是当前浏览器上的路径地址</span></span><br><span class="line">  <span class="keyword">const</span> selectedKey = location.<span class="property">pathname</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Menu</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">mode</span>=<span class="string">&quot;inline&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">theme</span>=<span class="string">&quot;dark&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">selectedKeys</span>=<span class="string">&#123;[selectedKey]&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">height:</span> &#x27;<span class="attr">100</span>%&#x27;, <span class="attr">borderRight:</span> <span class="attr">0</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">HomeOutlined</span> /&gt;</span>&#125; key=&quot;/&quot;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>数据概览<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DiffOutlined</span> /&gt;</span>&#125; key=&quot;/article&quot;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/article&quot;</span>&gt;</span>内容管理<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; key=&quot;/publish&quot;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/publish&quot;</span>&gt;</span>发布文章<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Menu</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-展示个人信息"><a href="#4-展示个人信息" class="headerlink" title="4. 展示个人信息"></a>4. 展示个人信息</h2><p><code>本节目标:</code>  能够在页面右上角展示登录用户名</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 在store中新增userStore.js模块，在其中定义获取用户信息的mobx代码</p>
</li>
<li><p> 在store的入口文件中组合新增的userStore模块</p>
</li>
<li><p> 在Layout组件中调用action函数获取用户数据，由于这是副作用，因此使用 <code>useEffect</code> 方法，只在最开始执行一次，虽然加上了userStore的依赖项，但这只是为了避免报错（useEffect中使用的数据必须要加入到依赖项中）</p>
</li>
<li><p> 在Layout组件中获取个人信息并展示</p>
</li>
</ol>
<h3 id="问题-2"><a href="#问题-2" class="headerlink" title="问题"></a>问题</h3><p><code>userStore</code>中发送请求获取数据时，this.userInfo = res.data，而不是res.data.data</p>
<p><strong>代码实现</strong></p>
<p><code>store/user.Store.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; makeAutoObservable &#125; <span class="keyword">from</span> <span class="string">&quot;mobx&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; http &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserStore</span> &#123;</span><br><span class="line">  userInfo = &#123;&#125;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">makeAutoObservable</span>(<span class="variable language_">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getUserInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> http.<span class="title function_">get</span>(<span class="string">&#x27;/user/profile&#x27;</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userInfo</span> = res.<span class="property">data</span>.<span class="property">data</span> <span class="comment">//这里写错了，应该为res.data</span></span><br><span class="line">    <span class="comment">//因为http 模块发送请求后得到的数据已经设置为res.data了</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">UserStore</span></span><br></pre></td></tr></table></figure>

<p>store/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LoginStore</span> <span class="keyword">from</span> <span class="string">&#x27;./login.Store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserStore</span> <span class="keyword">from</span> <span class="string">&#x27;./user.Store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RootStore</span> &#123;</span><br><span class="line">  <span class="comment">// 组合模块</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">loginStore</span> = <span class="keyword">new</span> <span class="title class_">LoginStore</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userStore</span> = <span class="keyword">new</span> <span class="title class_">UserStore</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">StoresContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(<span class="keyword">new</span> <span class="title class_">RootStore</span>())</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">useStore</span> = (<span class="params"></span>) =&gt; <span class="title class_">React</span>.<span class="title function_">useContext</span>(<span class="title class_">StoresContext</span>)</span><br></pre></td></tr></table></figure>

<p>pages/Layout/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; observer &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react-lite&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">GeekLayout</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; userStore &#125; = <span class="title function_">useStore</span>()</span><br><span class="line">  <span class="comment">// 获取用户数据</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      userStore.<span class="title function_">getUserInfo</span>()</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123; &#125;</span><br><span class="line">  &#125;, [userStore])</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Header</span> <span class="attr">className</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;logo&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;user-info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;user-name&quot;</span>&gt;</span>&#123;userStore.userInfo.name&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 省略无关代码 */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">observer</span>(<span class="title class_">GeekLayout</span>)</span><br></pre></td></tr></table></figure>

<h2 id="5-退出登录实现"><a href="#5-退出登录实现" class="headerlink" title="5. 退出登录实现"></a>5. 退出登录实现</h2><p><code>本节目标:</code>  能够实现退出登录功能</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 为气泡确认框添加确认回调事件</p>
</li>
<li><p> 在<code>store/login.Store.js</code> 中新增退出登录的action函数，在其中删除token</p>
</li>
<li><p> 在回调事件中，调用loginStore中的退出action</p>
</li>
<li><p> 退出后，返回登录页面</p>
</li>
</ol>
<p>useNavigate 也是一个hook函数，只能在另一个hook函数或函数组件中使用</p>
<p><strong>代码实现</strong></p>
<p><code>store/login.Store.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LoginStore</span> &#123;</span><br><span class="line">  <span class="comment">// 退出登录</span></span><br><span class="line">  loginOut = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">token</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="title function_">clearToken</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">LoginStore</span></span><br></pre></td></tr></table></figure>

<p>pages/Layout/index.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// login out</span></span><br><span class="line"><span class="keyword">const</span> navigate = <span class="title function_">useNavigate</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onLogout</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    loginStore.<span class="title function_">loginOut</span>()</span><br><span class="line">    <span class="title function_">navigate</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;span className=<span class="string">&quot;user-logout&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Popconfirm</span> <span class="attr">title</span>=<span class="string">&quot;是否确认退出？&quot;</span> <span class="attr">okText</span>=<span class="string">&quot;退出&quot;</span> <span class="attr">cancelText</span>=<span class="string">&quot;取消&quot;</span> <span class="attr">onConfirm</span>=<span class="string">&#123;onLogout&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">LogoutOutlined</span> /&gt;</span> 退出</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Popconfirm</span>&gt;</span></span></span><br><span class="line">&lt;/span&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-处理Token失效"><a href="#6-处理Token失效" class="headerlink" title="6. 处理Token失效"></a>6. 处理Token失效</h2><p><code>本节目标:</code>  能够在响应拦截器中处理token失效</p>
<p>说明：为了能够在非组件环境下拿到路由信息，需要我们安装一个history包</p>
<p>react Router默认状态下，并不支持在组件之外完成路由跳转，因此要用别的方式实现，因此要安装history包</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;history&#x27;</span> </span><br><span class="line"><span class="keyword">import</span> &#123; unstable_HistoryRouter <span class="keyword">as</span> <span class="title class_">HistoryRouter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> history = <span class="title function_">createBrowserHistory</span>() </span><br><span class="line"></span><br><span class="line"><span class="comment">// App.js里面要用HistoryRouter 包裹</span></span><br><span class="line"><span class="comment">// 这样就能在外面的非组件中使用history.push(/&#x27;&#x27;)</span></span><br><span class="line">&lt;<span class="title class_">HistoryRouter</span> history=&#123;history&#125;&gt;</span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">HistoryRouter</span>&gt;</span><br></pre></td></tr></table></figure>

<p><strong>实现步骤</strong></p>
<ol>
<li><p> 安装history包：<code>yarn add history</code></p>
</li>
<li><p> 创建 <code>utils/history.js</code>文件</p>
</li>
<li><p> 在app.js中使用我们新建的路由并配置history参数</p>
</li>
<li><p> 通过响应拦截器处理 token 失效，如果发现是401调回到登录页</p>
</li>
</ol>
<h4 id="问题-3"><a href="#问题-3" class="headerlink" title="问题"></a>问题</h4><p>在app中使用HistoryRouter时，应该是替换掉BrowerRouter，而不是包裹住它</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">HistoryRouter</span> <span class="attr">history</span>=<span class="string">&#123;history&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       ...省略无关代码</span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">HistoryRouter</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>代码实现</strong></p>
<p><code>utils/history.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/remix-run/react-router/issues/8264</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;history&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; unstable_HistoryRouter <span class="keyword">as</span> <span class="title class_">HistoryRouter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">const</span> history = <span class="title function_">createBrowserHistory</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="title class_">HistoryRouter</span>,</span><br><span class="line">  history</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>app.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HistoryRouter</span>, history &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/history&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">HistoryRouter</span> <span class="attr">history</span>=<span class="string">&#123;history&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       ...省略无关代码</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">HistoryRouter</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>

<p>utils/http.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; history &#125; <span class="keyword">from</span> <span class="string">&#x27;./history&#x27;</span></span><br><span class="line"></span><br><span class="line">http.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 当 token 失效的时候，请求返回的状态码是401，</span></span><br><span class="line">    <span class="comment">// 此时要跳转到 登录页面</span></span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">response</span>.<span class="property">status</span> === <span class="number">401</span>) &#123;</span><br><span class="line">      <span class="comment">// 删除token</span></span><br><span class="line">      <span class="title function_">clearToken</span>()</span><br><span class="line">      <span class="comment">// 跳转到登录页</span></span><br><span class="line">      history.<span class="title function_">push</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="7-首页Home图表展示"><a href="#7-首页Home图表展示" class="headerlink" title="7. 首页Home图表展示"></a>7. 首页Home图表展示</h2><p><code>本节目标:</code>  实现首页echart图表封装展示</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ec29955e15343aab72791786c8fa384~tplv-k3u1fbpfcp-zoom-1.image"><br><strong>需求描述：</strong></p>
<ol>
<li> 安装echarts <code>npm add echarts</code></li>
<li> 使用eharts配合react封装柱状图组件Bar</li>
<li> 要求组件的标题title，横向数据xData，纵向数据yData，样式style可定制</li>
</ol>
<p><strong>代码实现</strong><br>components/Bar/index.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">echartInit</span> (node, xData, sData, title) &#123;</span><br><span class="line">  <span class="keyword">const</span> myChart = echarts.<span class="title function_">init</span>(node)</span><br><span class="line">  <span class="comment">// 绘制图表</span></span><br><span class="line">  myChart.<span class="title function_">setOption</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: &#123;</span><br><span class="line">      <span class="attr">text</span>: title</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">tooltip</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">xAxis</span>: &#123;</span><br><span class="line">      <span class="attr">data</span>: xData</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">yAxis</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">series</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;销量&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: sData</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Bar</span> (&#123; style, xData, sData, title &#125;) &#123;</span><br><span class="line">  <span class="comment">// 1. 先不考虑传参问题  静态数据渲染到页面中</span></span><br><span class="line">  <span class="comment">// 2. 把那些用户可能定制的参数 抽象props (1.定制大小 2.data 以及说明文字)</span></span><br><span class="line">  <span class="keyword">const</span> nodeRef = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">echartInit</span>(nodeRef.<span class="property">current</span>, xData, sData, title)</span><br><span class="line">  &#125;, [xData, sData])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;nodeRef&#125;</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Bar</span></span><br></pre></td></tr></table></figure>

<p>pages/Home/index.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Bar</span> <span class="keyword">from</span> <span class="string">&quot;@/components/Bar&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.scss&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Home</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;home&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Bar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">500px</span>&#x27;, <span class="attr">height:</span> &#x27;<span class="attr">400px</span>&#x27; &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xData</span>=<span class="string">&#123;[</span>&#x27;<span class="attr">vue</span>&#x27;, &#x27;<span class="attr">angular</span>&#x27;, &#x27;<span class="attr">react</span>&#x27;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">sData</span>=<span class="string">&#123;[50,</span> <span class="attr">60</span>, <span class="attr">70</span>]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">title</span>=<span class="string">&#x27;三大框架满意度&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Bar</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">500px</span>&#x27;, <span class="attr">height:</span> &#x27;<span class="attr">400px</span>&#x27; &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">xData</span>=<span class="string">&#123;[</span>&#x27;<span class="attr">vue</span>&#x27;, &#x27;<span class="attr">angular</span>&#x27;, &#x27;<span class="attr">react</span>&#x27;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">sData</span>=<span class="string">&#123;[50,</span> <span class="attr">60</span>, <span class="attr">70</span>]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">title</span>=<span class="string">&#x27;三大框架使用度&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Home</span></span><br></pre></td></tr></table></figure>

<p>pages/Home/index.scss</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.home</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-文章管理模块"><a href="#4-文章管理模块" class="headerlink" title="4. 文章管理模块"></a>4. 文章管理模块</h1><h2 id="1-筛选区结构"><a href="#1-筛选区结构" class="headerlink" title="1. 筛选区结构"></a>1. 筛选区结构</h2><p>本节目标: 能够使用antd组件库搭建筛选区域结构</p>
<p>重点关注</p>
<ol>
<li> 如何让RangePicker日期范围选择框选择中文</li>
<li>Select组件配合Form.Item使用时，如何配置默认选中项<br> <code>&lt;Form initialValues=&#123;&#123; status: null &#125;&#125; &gt;</code></li>
</ol>
<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Card</span>, <span class="title class_">Breadcrumb</span>, <span class="title class_">Form</span>, <span class="title class_">Button</span>, <span class="title class_">Radio</span>, <span class="title class_">DatePicker</span>, <span class="title class_">Select</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;moment/locale/zh-cn&#x27;</span></span><br><span class="line"><span class="keyword">import</span> locale <span class="keyword">from</span> <span class="string">&#x27;antd/es/date-picker/locale/zh_CN&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Option</span> &#125; = <span class="title class_">Select</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">RangePicker</span> &#125; = <span class="title class_">DatePicker</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Article</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Card</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">title</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &lt;<span class="attr">Breadcrumb</span> <span class="attr">separator</span>=<span class="string">&quot;&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Breadcrumb.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Breadcrumb.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Breadcrumb.Item</span>&gt;</span>内容管理<span class="tag">&lt;/<span class="name">Breadcrumb.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Breadcrumb</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">        style=&#123;&#123; marginBottom: 20 &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Form</span> <span class="attr">initialValues</span>=<span class="string">&#123;&#123;</span> <span class="attr">status:</span> <span class="attr">null</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">label</span>=<span class="string">&quot;状态&quot;</span> <span class="attr">name</span>=<span class="string">&quot;status&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Radio.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;null&#125;</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;0&#125;</span>&gt;</span>草稿<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;1&#125;</span>&gt;</span>待审核<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;2&#125;</span>&gt;</span>审核通过<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;3&#125;</span>&gt;</span>审核失败<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Radio.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">label</span>=<span class="string">&quot;频道&quot;</span> <span class="attr">name</span>=<span class="string">&quot;channel_id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Select</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">placeholder</span>=<span class="string">&quot;请选择文章频道&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">defaultValue</span>=<span class="string">&quot;lucy&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> <span class="attr">120</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;jack&quot;</span>&gt;</span>Jack<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&quot;lucy&quot;</span>&gt;</span>Lucy<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">label</span>=<span class="string">&quot;日期&quot;</span> <span class="attr">name</span>=<span class="string">&quot;date&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* ant5不需要再这么写：传入locale属性 控制中文显示*/&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;/*<span class="tag">&lt;<span class="name">RangePicker</span> <span class="attr">locale</span>=<span class="string">&#123;locale&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">RangePicker</span>&gt;</span>*/&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">RangePicker</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">format</span>=<span class="string">&quot;YYYY-MM-DD&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">RangePicker</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">htmlType</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginLeft:</span> <span class="attr">80</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">              筛选</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Article</span></span><br></pre></td></tr></table></figure>

<h3 id="问题-4"><a href="#问题-4" class="headerlink" title="问题"></a>问题</h3><p>ant5 设置语言不再是在各个文件中更改，而是在最外层的<code>index.js</code> 组件中 使用 <code>ConfigProvider</code> 进行全局化配置，具体代码如下</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;antd/dist/reset.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.scss&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ConfigProvider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> zhCN <span class="keyword">from</span> <span class="string">&#x27;antd/locale/zh_CN&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line"></span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">ConfigProvider</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">locale</span>=<span class="string">&#123;zhCN&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">theme</span>=<span class="string">&#123;&#123;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">token:</span> &#123; </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">colorPrimary:</span> &quot;#<span class="attr">A0D911</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;    </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">ConfigProvider</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-表格区域结构"><a href="#2-表格区域结构" class="headerlink" title="2. 表格区域结构"></a>2. 表格区域结构</h2><p><code>本节目标:</code> 能够基于Table组件搭建表格结构</p>
<p>重点关注</p>
<ol>
<li><p> 通过哪个属性指定Table组件的列信息</p>
</li>
<li><p> 通过哪个属性指定Table数据</p>
</li>
<li><p> 通过哪个属性指定Table列表用到的key属性</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Table</span>, <span class="title class_">Tag</span>, <span class="title class_">Space</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EditOutlined</span>, <span class="title class_">DeleteOutlined</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> img404 <span class="keyword">from</span> <span class="string">&#x27;@/assets/error.png&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Article</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> columns = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;封面&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;cover&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>:<span class="number">120</span>,</span><br><span class="line">      <span class="attr">render</span>: <span class="function"><span class="params">cover</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;cover</span> || <span class="attr">img404</span>&#125; <span class="attr">width</span>=<span class="string">&#123;80&#125;</span> <span class="attr">height</span>=<span class="string">&#123;60&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;标题&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">220</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;status&#x27;</span>,</span><br><span class="line">      <span class="attr">render</span>: <span class="function"><span class="params">data</span> =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Tag</span> <span class="attr">color</span>=<span class="string">&quot;green&quot;</span>&gt;</span>审核通过<span class="tag">&lt;/<span class="name">Tag</span>&gt;</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;发布时间&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;pubdate&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;阅读数&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;read_count&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;评论数&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;comment_count&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;点赞数&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;like_count&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">      <span class="attr">render</span>: <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">Space</span> <span class="attr">size</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">danger</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Space</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> data = [</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="string">&#x27;8218&#x27;</span>,</span><br><span class="line">          <span class="attr">comment_count</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">cover</span>: &#123;</span><br><span class="line">            <span class="attr">images</span>:[<span class="string">&#x27;http://geek.itheima.net/resources/images/15.jpg&#x27;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">like_count</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">pubdate</span>: <span class="string">&#x27;2019-03-11 09:00:00&#x27;</span>,</span><br><span class="line">          <span class="attr">read_count</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="attr">status</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;wkwebview离线化加载h5资源解决方案&#x27;</span> </span><br><span class="line">      &#125;</span><br><span class="line">  ]</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Card</span> <span class="attr">title</span>=<span class="string">&#123;</span>`<span class="attr">根据筛选条件共查询到</span> <span class="attr">count</span> <span class="attr">条结果</span>：`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Table</span> <span class="attr">rowKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span> <span class="attr">dataSource</span>=<span class="string">&#123;data&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="问题-5"><a href="#问题-5" class="headerlink" title="问题"></a>问题</h3><p>封面部分的代码有问题，从第5.8章节可以知道，<code>cover</code> 是一个对象，里面包含了type和images列表（多张图片的url），因此src应该等于 <code>cover.imges[i]</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;封面&#x27;</span>,</span><br><span class="line">  <span class="attr">dataIndex</span>: <span class="string">&#x27;cover&#x27;</span>,</span><br><span class="line">  <span class="attr">width</span>:<span class="number">120</span>,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">cover</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;cover.images</span> || <span class="attr">img404</span>&#125; <span class="attr">width</span>=<span class="string">&#123;80&#125;</span> <span class="attr">height</span>=<span class="string">&#123;60&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-渲染频道数据"><a href="#3-渲染频道数据" class="headerlink" title="3. 渲染频道数据"></a>3. 渲染频道数据</h2><p><code>本节目标:</code>  使用接口数据渲染频道列表</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 使用axios获取数据</p>
</li>
<li><p> 将使用频道数据列表改写下拉框组件</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>pages/Article/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取频道列表</span></span><br><span class="line"><span class="keyword">const</span> [channels, setChannels] = <span class="title function_">useState</span>([])</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchChannels</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> http.<span class="title function_">get</span>(<span class="string">&#x27;/channels&#x27;</span>)</span><br><span class="line">      <span class="title function_">setChannels</span>(res.<span class="property">data</span>.<span class="property">channels</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">fetchChannels</span>()</span><br><span class="line">&#125;, [])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染模板</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">label</span>=<span class="string">&quot;频道&quot;</span> <span class="attr">name</span>=<span class="string">&quot;channel_id&quot;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Select</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择文章频道&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> <span class="attr">200</span> &#125;&#125; &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;channels.map(item =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Option</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">value</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;item.name&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="4-渲染表格数据"><a href="#4-渲染表格数据" class="headerlink" title="4. 渲染表格数据"></a>4. 渲染表格数据</h2><p><code>本节目标:</code>  使用接口数据渲染表格数据</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 声明列表相关数据管理</p>
</li>
<li><p> 声明参数相关数据管理</p>
</li>
<li><p> 调用接口获取数据</p>
</li>
<li><p> 使用接口数据渲染模板</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文章列表数据管理</span></span><br><span class="line"><span class="keyword">const</span> [article, setArticleList] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">list</span>: [],</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数管理</span></span><br><span class="line"><span class="keyword">const</span> [params, setParams] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">    <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">per_page</span>: <span class="number">10</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送接口请求</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchArticleList</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> http.<span class="title function_">get</span>(<span class="string">&#x27;/mp/articles&#x27;</span>, &#123; params &#125;)</span><br><span class="line">      <span class="keyword">const</span> &#123; results, total_count &#125; = res.<span class="property">data</span></span><br><span class="line">      <span class="title function_">setArticleList</span>(&#123;</span><br><span class="line">        <span class="attr">list</span>: results,</span><br><span class="line">        <span class="attr">count</span>: total_count</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">fetchArticleList</span>()</span><br><span class="line">&#125;, [params])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模板渲染</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"> <span class="language-xml"><span class="tag">&lt;<span class="name">Card</span> <span class="attr">title</span>=<span class="string">&#123;</span>`<span class="attr">根据筛选条件共查询到</span> $&#123;<span class="attr">article.count</span>&#125; <span class="attr">条结果</span>：`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Table</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">dataSource</span>=<span class="string">&#123;article.list&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="5-筛选功能实现"><a href="#5-筛选功能实现" class="headerlink" title="5. 筛选功能实现"></a>5. 筛选功能实现</h2><p><code>本节目标:</code> 能够根据筛选条件筛选表格数据</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 为表单添加<code>onFinish</code>属性监听表单提交事件，获取参数</p>
</li>
<li><p> 根据接口字段格式要求格式化参数格式</p>
</li>
<li><p> 修改<code>params</code> 触发接口的重新发送</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 筛选功能</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSearch</span> = values =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; status, channel_id, date &#125; = values</span><br><span class="line">    <span class="comment">// 格式化表单数据</span></span><br><span class="line">    <span class="keyword">const</span> _params = &#123;&#125;</span><br><span class="line">    <span class="comment">// 格式化status</span></span><br><span class="line">    _params.<span class="property">status</span> = status</span><br><span class="line">    <span class="keyword">if</span> (channel_id) &#123;</span><br><span class="line">      _params.<span class="property">channel_id</span> = channel_id</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (date) &#123;</span><br><span class="line">      _params.<span class="property">begin_pubdate</span> = date[<span class="number">0</span>].<span class="title function_">format</span>(<span class="string">&#x27;YYYY-MM-DD&#x27;</span>)</span><br><span class="line">      _params.<span class="property">end_pubdate</span> = date[<span class="number">1</span>].<span class="title function_">format</span>(<span class="string">&#x27;YYYY-MM-DD&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 修改params参数 触发接口再次发起</span></span><br><span class="line">    <span class="title function_">setParams</span>(&#123;</span><br><span class="line">       ...params,</span><br><span class="line">       ..._params</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Form绑定事件</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">onFinish</span>=<span class="string">&#123;</span> <span class="attr">onSearch</span> &#125;&gt;</span><span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="6-分页功能实现"><a href="#6-分页功能实现" class="headerlink" title="6. 分页功能实现"></a>6. 分页功能实现</h2><p><code>本节目标:</code>  能够实现分页获取文章列表数据</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 为Table组件指定pagination属性来展示分页效果</p>
</li>
<li><p> 在分页切换事件中获取到筛选表单中选中的数据</p>
</li>
<li><p> 使用当前页数据修改params参数依赖引起接口重新调用获取最新数据</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">pageChange</span> = (<span class="params">page</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 拿到当前页参数 修改params 引起接口更新</span></span><br><span class="line">    <span class="title function_">setParams</span>(&#123;</span><br><span class="line">      ...params,</span><br><span class="line">      page</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">Table</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">dataSource</span>=<span class="string">&#123;article.list&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">position:</span> [&#x27;<span class="attr">bottomCenter</span>&#x27;],</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">current:</span> <span class="attr">params.page</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">pageSize:</span> <span class="attr">params.per_page</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange:</span> <span class="attr">pageChange</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="问题-6"><a href="#问题-6" class="headerlink" title="问题"></a>问题</h3><p>按照以上代码编写无法实现分页功能，antd5应该在哪里有了改动</p>
<p>解决方法：参数写错了，正确代码如下</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Table</span> rowKey=<span class="string">&quot;id&quot;</span> columns=&#123;columns&#125; dataSource=&#123;article.<span class="property">list</span>&#125; </span><br><span class="line">    pagination=&#123;&#123;</span><br><span class="line">        <span class="attr">position</span>: [<span class="string">&#x27;bottomCenter&#x27;</span>],</span><br><span class="line">        <span class="attr">current</span>: params.<span class="property">page</span>,</span><br><span class="line">        <span class="attr">pageSize</span>: params.<span class="property">per_page</span>,<span class="comment">//每一页多少数据</span></span><br><span class="line">        <span class="attr">total</span>: article.<span class="property">count</span>,<span class="comment">//总共多少数据</span></span><br><span class="line">        <span class="attr">onChange</span>: pageChange</span><br><span class="line">    &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-5-useState与useEffect的拆分粒度"><a href="#6-5-useState与useEffect的拆分粒度" class="headerlink" title="6.5 useState与useEffect的拆分粒度"></a>6.5 useState与useEffect的拆分粒度</h2><p>代码中写了多个 <code>useState</code>和 <code>useEffect</code>，不能将它们合并在一起，因为它们的业务逻辑不同，不同的<code>useEffect</code>依赖的数据不同。</p>
<h2 id="7-删除功能"><a href="#7-删除功能" class="headerlink" title="7. 删除功能"></a>7. 删除功能</h2><p><code>本节目标:</code>  能够实现点击删除按钮弹框确认</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 给删除文章按钮绑定点击事件</p>
</li>
<li><p> 弹出确认窗口，询问用户是否确定删除文章</p>
</li>
<li><p> 拿到参数调用删除接口，更新列表</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除回调</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">delArticle</span> = <span class="keyword">async</span> (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> http.<span class="title function_">delete</span>(<span class="string">`/mp/articles/<span class="subst">$&#123;data.id&#125;</span>`</span>)</span><br><span class="line">    <span class="comment">// 更新列表</span></span><br><span class="line">    <span class="title function_">setParams</span>(&#123;</span><br><span class="line">      <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">per_page</span>: <span class="number">10</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> columns = [</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">      <span class="attr">render</span>: <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">Space</span> <span class="attr">size</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Popconfirm</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">title</span>=<span class="string">&quot;确认删除该条文章吗?&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onConfirm</span>=<span class="string">&#123;()</span> =&gt;</span> delArticle(data)&#125;</span></span><br><span class="line"><span class="language-xml">              okText=&quot;确认&quot;</span></span><br><span class="line"><span class="language-xml">              cancelText=&quot;取消&quot;</span></span><br><span class="line"><span class="language-xml">            &gt;</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">danger</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">              /&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Popconfirm</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Space</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="8-编辑文章跳转"><a href="#8-编辑文章跳转" class="headerlink" title="8. 编辑文章跳转"></a>8. 编辑文章跳转</h2><p><code>本节目标:</code>  能够实现编辑文章跳转功能</p>
<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> columns = [</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">    <span class="attr">render</span>: <span class="function"><span class="params">data</span> =&gt;</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Space</span> <span class="attr">size</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">          onClick=&#123;() =&gt; history.push(`/home/publish?id=$&#123;data.id&#125;`)&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Space</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h1 id="5-发布文章模块"><a href="#5-发布文章模块" class="headerlink" title="5. 发布文章模块"></a>5. 发布文章模块</h1><h2 id="1-基本结构搭建-2"><a href="#1-基本结构搭建-2" class="headerlink" title="1. 基本结构搭建"></a>1. 基本结构搭建</h2><p><code>本节目标:</code>  能够搭建发布文章页面的基本结构</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 使用Card、Form组件搭建基本页面结构</p>
</li>
<li><p> 创建样式文件，对样式做出调整</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>pages/Publish/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">Card</span>,</span><br><span class="line">  <span class="title class_">Breadcrumb</span>,</span><br><span class="line">  <span class="title class_">Form</span>,</span><br><span class="line">  <span class="title class_">Button</span>,</span><br><span class="line">  <span class="title class_">Radio</span>,</span><br><span class="line">  <span class="title class_">Input</span>,</span><br><span class="line">  <span class="title class_">Upload</span>,</span><br><span class="line">  <span class="title class_">Space</span>,</span><br><span class="line">  <span class="title class_">Select</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PlusOutlined</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Option</span> &#125; = <span class="title class_">Select</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Publish</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;publish&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Card</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">title</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &lt;<span class="attr">Breadcrumb</span> <span class="attr">separator</span>=<span class="string">&quot;&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Breadcrumb.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Breadcrumb.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Breadcrumb.Item</span>&gt;</span>发布文章<span class="tag">&lt;/<span class="name">Breadcrumb.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Breadcrumb</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Form</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">labelCol</span>=<span class="string">&#123;&#123;</span> <span class="attr">span:</span> <span class="attr">4</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">wrapperCol</span>=<span class="string">&#123;&#123;</span> <span class="attr">span:</span> <span class="attr">16</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">initialValues</span>=<span class="string">&#123;&#123;</span> <span class="attr">type:</span> <span class="attr">1</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">label</span>=<span class="string">&quot;标题&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">name</span>=<span class="string">&quot;title&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">请输入文章标题</span>&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Input</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入文章标题&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> <span class="attr">400</span> &#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">label</span>=<span class="string">&quot;频道&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">name</span>=<span class="string">&quot;channel_id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">请选择文章频道</span>&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Select</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择文章频道&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> <span class="attr">400</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#123;0&#125;</span>&gt;</span>推荐<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">label</span>=<span class="string">&quot;封面&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Radio.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;1&#125;</span>&gt;</span>单图<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;3&#125;</span>&gt;</span>三图<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;0&#125;</span>&gt;</span>无图<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">Radio.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Upload</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">name</span>=<span class="string">&quot;image&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">listType</span>=<span class="string">&quot;picture-card&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">className</span>=<span class="string">&quot;avatar-uploader&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">showUploadList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginTop:</span> <span class="attr">8</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">PlusOutlined</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Upload</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">label</span>=<span class="string">&quot;内容&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">name</span>=<span class="string">&quot;content&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">请输入文章内容</span>&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span><span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">wrapperCol</span>=<span class="string">&#123;&#123;</span> <span class="attr">offset:</span> <span class="attr">4</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Space</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Button</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">htmlType</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                发布文章</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Space</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Publish</span></span><br></pre></td></tr></table></figure>

<p>pages/Publish/index.scss</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.publish</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.ant-upload-list</span> &#123;</span><br><span class="line">  <span class="selector-class">.ant-upload-list-picture-card-container</span>,</span><br><span class="line">  <span class="selector-class">.ant-upload-select</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">146px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">146px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-富文本编辑器"><a href="#2-富文本编辑器" class="headerlink" title="2. 富文本编辑器"></a>2. 富文本编辑器</h2><p><code>本节目标:</code>  能够安装并初始化富文本编辑器</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 安装富文本编辑器：<code>yarn add react-quill@2.0.0-beta.2</code> [react-quill需要安装beta版本适配react18 否则无法输入中文]</p>
</li>
<li><p> 导入富文本编辑器组件以及样式文件</p>
</li>
<li><p> 渲染富文本编辑器组件</p>
</li>
<li><p> 通过 Form 组件的 <code>initialValues</code> 为富文本编辑器设置初始值，否则会报错</p>
</li>
<li><p> 调整富文本编辑器的样式</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>pages/Publish/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ReactQuill</span> <span class="keyword">from</span> <span class="string">&#x27;react-quill&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;react-quill/dist/quill.snow.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Publish</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">labelCol</span>=<span class="string">&#123;&#123;</span> <span class="attr">span:</span> <span class="attr">4</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">wrapperCol</span>=<span class="string">&#123;&#123;</span> <span class="attr">span:</span> <span class="attr">16</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      // <span class="attr">注意</span>：<span class="attr">此处需要为富文本编辑表示的</span> <span class="attr">content</span> <span class="attr">文章内容设置默认值</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">initialValues</span>=<span class="string">&#123;&#123;</span> <span class="attr">content:</span> &#x27;&#x27; &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">label</span>=<span class="string">&quot;内容&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">name</span>=<span class="string">&quot;content&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">请输入文章内容</span>&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ReactQuill</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">className</span>=<span class="string">&quot;publish-quill&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">theme</span>=<span class="string">&quot;snow&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">placeholder</span>=<span class="string">&quot;请输入文章内容&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pages/Publish/index.scss</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.publish-quill</span> &#123;</span><br><span class="line">  <span class="selector-class">.ql-editor</span> &#123;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">300px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-频道数据获取"><a href="#3-频道数据获取" class="headerlink" title="3. 频道数据获取"></a>3. 频道数据获取</h2><p><code>本节目标:</code> 实现频道数据的获取和渲染</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 使用useState初始化数据和修改数据的方法</p>
</li>
<li><p> 在useEffect中调用接口并保存数据</p>
</li>
<li><p> 使用数据渲染对应模块</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 频道列表</span></span><br><span class="line"><span class="keyword">const</span> [channels, setChannels] = <span class="title function_">useState</span>([])</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchChannels</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> http.<span class="title function_">get</span>(<span class="string">&#x27;/channels&#x27;</span>)</span><br><span class="line">      <span class="title function_">setChannels</span>(res.<span class="property">data</span>.<span class="property">channels</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">fetchChannels</span>()</span><br><span class="line">&#125;, [])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模板渲染</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"> <span class="language-xml"><span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">label</span>=<span class="string">&quot;频道&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">name</span>=<span class="string">&quot;channel_id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">请选择文章频道</span>&#x27; &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  &gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Select</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择文章频道&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> <span class="attr">200</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;channels.map(item =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Option</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">value</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;item.name&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="4-上传封面实现"><a href="#4-上传封面实现" class="headerlink" title="4. 上传封面实现"></a>4. 上传封面实现</h2><p><code>本节目标:</code> 能够实现上传图片</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 为 Upload 组件添加 action 属性，指定封面图片上传接口地址</p>
</li>
<li><p> 创建状态 fileList 存储已上传封面图片地址，并设置为 Upload 组件的 fileList 属性值</p>
</li>
<li><p> 为 Upload 添加 onChange 属性，监听封面图片上传、删除等操作</p>
</li>
<li><p> 在 change 事件中拿到当前图片数据，并存储到状态 fileList 中</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Publish</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [fileList, setFileList] = <span class="title function_">useState</span>([])</span><br><span class="line">  <span class="comment">// 上传成功回调</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onUploadChange</span> = info =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> fileList = info.<span class="property">fileList</span>.<span class="title function_">map</span>(<span class="function"><span class="params">file</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (file.<span class="property">response</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="attr">url</span>: file.<span class="property">response</span>.<span class="property">data</span>.<span class="property">url</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> file</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">setFileList</span>(fileList)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Upload</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">name</span>=<span class="string">&quot;image&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">listType</span>=<span class="string">&quot;picture-card&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&quot;avatar-uploader&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">showUploadList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">action</span>=<span class="string">&quot;http://geek.itheima.net/v1_0/upload&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">fileList</span>=<span class="string">&#123;fileList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onChange</span>=<span class="string">&#123;onUploadChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginTop:</span> <span class="attr">8</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">PlusOutlined</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Upload</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-切换图片Type"><a href="#5-切换图片Type" class="headerlink" title="5.切换图片Type"></a>5.切换图片Type</h2><p><code>本节目标:</code> 实现点击切换图片类型</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 创建状态 maxCount</p>
</li>
<li><p> 给 Radio 添加 onChange 监听单图、三图、无图的切换事件</p>
</li>
<li><p> 在切换事件中修改 maxCount 值</p>
</li>
<li><p> 只在 maxCount 不为零时展示 Upload 组件</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>pages/Publish/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Publish</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [imgCount, setImgCount] = <span class="title function_">useState</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">changeType</span> = e =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> count = e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">    <span class="title function_">setImgCount</span>(count)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">label</span>=<span class="string">&quot;封面&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Radio.Group</span> <span class="attr">onChange</span>=<span class="string">&#123;changeType&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;1&#125;</span>&gt;</span>单图<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;3&#125;</span>&gt;</span>三图<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;0&#125;</span>&gt;</span>无图<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Radio.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;maxCount &gt; 0 &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Upload</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;image&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">listType</span>=<span class="string">&quot;picture-card&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">className</span>=<span class="string">&quot;avatar-uploader&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">showUploadList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">action</span>=<span class="string">&quot;http://geek.itheima.net/v1_0/upload&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginTop:</span> <span class="attr">8</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">PlusOutlined</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Upload</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-控制最大上传数量"><a href="#6-控制最大上传数量" class="headerlink" title="6. 控制最大上传数量"></a>6. 控制最大上传数量</h2><p><code>本节目标:</code> 控制Upload组件的最大上传数量和是否支持多张图片</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 修改 Upload 组件的 <code>maxCount（最大数量）</code>属性控制最大上传数量</p>
</li>
<li><p> 控制<code>multiple （支持多图选择）属性</code> 控制是否支持选择多张图片</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>pages/Publish/index.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Publish</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">label</span>=<span class="string">&quot;封面&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Radio.Group</span> <span class="attr">onChange</span>=<span class="string">&#123;changeType&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;1&#125;</span>&gt;</span>单图<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;3&#125;</span>&gt;</span>三图<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&#123;0&#125;</span>&gt;</span>无图<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Radio.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;maxCount &gt; 0 &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Upload</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;image&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">listType</span>=<span class="string">&quot;picture-card&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">className</span>=<span class="string">&quot;avatar-uploader&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">showUploadList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">action</span>=<span class="string">&quot;http://geek.itheima.net/v1_0/upload&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">maxCount</span>=<span class="string">&#123;</span> <span class="attr">maxCount</span> &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">multiple</span>=<span class="string">&#123;</span> <span class="attr">maxCount</span> &gt;</span> 1 &#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginTop:</span> <span class="attr">8</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">PlusOutlined</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Upload</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-暂存图片列表实现"><a href="#7-暂存图片列表实现" class="headerlink" title="7. 暂存图片列表实现"></a>7. 暂存图片列表实现</h2><p><code>本节目标:</code> 能够实现暂存已经上传的图片列表，能够在切换图片类型的时候完成切换</p>
<p><strong>问题描述</strong></p>
<p>如果当前为三图模式，已经完成了上传，选择单图只显示一张，再切换到三图继续显示三张，该如何实现？</p>
<p><strong>实现思路</strong></p>
<p>在上传完毕之后通过ref存储所有图片，需要几张就显示几张，其实也就是把ref当仓库，用多少拿多少</p>
<p><strong>实现步骤 （特别注意useState异步更新的坑）</strong></p>
<ol>
<li><p> 通过useRef创建一个暂存仓库，在上传完毕图片的时候把图片列表存入</p>
</li>
<li><p> 如果是单图模式，就从仓库里取第一张图，以<strong>数组的形式</strong>存入fileList</p>
</li>
<li><p> 如果是三图模式，就把仓库里所有的图片，以<strong>数组的形式</strong>存入fileList</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Publish</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 1. 声明一个暂存仓库</span></span><br><span class="line">  <span class="keyword">const</span> fileListRef = <span class="title function_">useRef</span>([])</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 2. 上传图片时，将所有图片存储到 ref 中</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onUploadChange</span> = info =&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    fileListRef.<span class="property">current</span> = imgUrls</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 3. 切换图片类型</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">changeType</span> = e =&gt; &#123;</span><br><span class="line">    <span class="comment">// 使用原始数据作为判断条件</span></span><br><span class="line">    <span class="keyword">const</span> count = e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">    <span class="title function_">setMaxCount</span>(count)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (count === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// 单图，只展示第一张</span></span><br><span class="line">      <span class="keyword">const</span> firstImg = fileListRef.<span class="property">current</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="title function_">setFileList</span>(!firstImg ? [] : [firstImg])</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (count === <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="comment">// 三图，展示所有图片</span></span><br><span class="line">      <span class="title function_">setFileList</span>(fileListRef.<span class="property">current</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-发布文章实现"><a href="#8-发布文章实现" class="headerlink" title="8. 发布文章实现"></a>8. 发布文章实现</h2><p><code>本节目标:</code> 能够在表单提交时组装表单数据并调用接口发布文章</p>
<p><strong>实现步骤</strong></p>
<ol>
<li> 给 Form 表单添加 <code>onFinish</code> 用来获取表单提交数据</li>
<li> 在事件处理程序中，拿到表单数据按照接口需要格式化数据</li>
<li> 调用接口实现文章发布，其中的接口数据格式为:（表单提交的数据中没有cover）</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">channel_id</span>: <span class="number">1</span></span><br><span class="line">   <span class="attr">content</span>: <span class="string">&quot;&lt;p&gt;测试&lt;/p&gt;&quot;</span> <span class="comment">//富文本编辑器产生的内容</span></span><br><span class="line">   <span class="attr">cover</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="number">1</span>, <span class="comment">//图片模式，单图、多图、无图</span></span><br><span class="line">      <span class="attr">images</span>: [<span class="string">&quot;http://geek.itheima.net/uploads/1647066600515.png&quot;</span>]</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">type</span>: <span class="number">1</span> <span class="comment">//图片模式，单图、多图、无图</span></span><br><span class="line">   <span class="attr">title</span>: <span class="string">&quot;测试文章&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">const</span> <span class="title function_">onFinish</span> = <span class="keyword">async</span> (<span class="params">values</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 数据的二次处理 重点是处理cover字段</span></span><br><span class="line">    <span class="keyword">const</span> &#123; channel_id, content, title, type &#125; = values</span><br><span class="line">    <span class="keyword">const</span> params = &#123;</span><br><span class="line">      channel_id,</span><br><span class="line">      content,</span><br><span class="line">      title,</span><br><span class="line">      type,</span><br><span class="line">      <span class="attr">cover</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: type,</span><br><span class="line">        <span class="attr">images</span>: fileList.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">response</span>.<span class="property">data</span>.<span class="property">url</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> http.<span class="title function_">post</span>(<span class="string">&#x27;/mp/articles?draft=false&#x27;</span>, params)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&lt;<span class="title class_">Form</span></span><br><span class="line">  labelCol=&#123;&#123; <span class="attr">span</span>: <span class="number">4</span> &#125;&#125;</span><br><span class="line">  wrapperCol=&#123;&#123; <span class="attr">span</span>: <span class="number">16</span> &#125;&#125;</span><br><span class="line">  initialValues=&#123;&#123; <span class="attr">type</span>: <span class="number">1</span> &#125;&#125;</span><br><span class="line">  onFinish=&#123;onFinish&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-编辑文章-文案适配"><a href="#9-编辑文章-文案适配" class="headerlink" title="9. 编辑文章-文案适配"></a>9. 编辑文章-文案适配</h2><p><code>本节目标:</code> 能够在编辑文章时展示数据</p>
<p><strong>实现步骤</strong></p>
<ol>
<li><p> 通过路由参数拿到文章id</p>
</li>
<li><p> 根据文章 id 是否存在判断是否为编辑状态</p>
</li>
<li><p> 如果是编辑状态，展示编辑时的文案信息</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useSearchParams &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Publish</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [params] = <span class="title function_">useSearchParams</span>()</span><br><span class="line">  <span class="keyword">const</span> articleId = params.<span class="title function_">get</span>(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Card</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">title</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &lt;<span class="attr">Breadcrumb</span> <span class="attr">separator</span>=<span class="string">&quot;&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Breadcrumb.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Breadcrumb.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Breadcrumb.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;articleId ? &#x27;修改文章&#x27; : &#x27;发布文章&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Breadcrumb.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Breadcrumb</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      // ...</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">htmlType</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;articleId ? &#x27;修改文章&#x27; : &#x27;发布文章&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  )</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="10-编辑文章-数据获取"><a href="#10-编辑文章-数据获取" class="headerlink" title="10.编辑文章-数据获取"></a>10.编辑文章-数据获取</h2><p><code>本节目标:</code> 使用id获取文章详情</p>
<p>判断文章 id 是否存在，如果存在就根据 id 获取文章详情数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getArticle</span> () &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> http.<span class="title function_">get</span>(<span class="string">`/mp/articles/<span class="subst">$&#123;articleId&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (articleId) &#123;</span><br><span class="line">      <span class="comment">// 拉取数据回显</span></span><br><span class="line">      <span class="title function_">getArticle</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, [articleId])</span><br></pre></td></tr></table></figure>

<h2 id="11-编辑文章-回显Form"><a href="#11-编辑文章-回显Form" class="headerlink" title="11. 编辑文章-回显Form"></a>11. 编辑文章-回显Form</h2><p><code>本节目标:</code> 完成Form组件的回填操作</p>
<p>调用Form组件的实例对象方法 <code>setFieldsValue</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getArticle</span> () &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> http.<span class="title function_">get</span>(<span class="string">`/mp/articles/<span class="subst">$&#123;articleId&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">const</span> &#123; cover, ...formValue &#125; = res.<span class="property">data</span></span><br><span class="line">      <span class="comment">// 动态设置表单数据</span></span><br><span class="line">      form.<span class="title function_">setFieldsValue</span>(&#123; ...formValue, <span class="attr">type</span>: cover.<span class="property">type</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (articleId) &#123;</span><br><span class="line">      <span class="comment">// 拉取数据回显</span></span><br><span class="line">      <span class="title function_">getArticle</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, [articleId])</span><br></pre></td></tr></table></figure>

<h2 id="12-编辑文章-回显Upload相关"><a href="#12-编辑文章-回显Upload相关" class="headerlink" title="12. 编辑文章-回显Upload相关"></a>12. 编辑文章-回显Upload相关</h2><p>1.Upload回显列表 fileList   2. 暂存列表 cacheImgList   3. 图片数量 imgCount</p>
<p>核心要点：<strong>fileList和暂存列表要求格式统一</strong></p>
<p>表单的赋值回显需要调用<code>setFieldsValue</code>方法，其中图片上传upload组件的回显依赖的数据格式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; <span class="attr">url</span>: <span class="string">&#x27;http://geek.itheima.net/uploads/1647066120170.png&#x27;</span> &#125;  </span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>接口返回的数据格式如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;f3f7ad67-6345-4fb7-a031-755e894258c2&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;云朵三个&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;channel_id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;p&gt;测试一下&lt;/p&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;http://geek.itheima.net/uploads/1685975569252.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;http://geek.itheima.net/uploads/1685975577904.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;http://geek.itheima.net/uploads/1685975578274.jpg&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pub_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-06-05 22:33:07&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OK&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>代码实现</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数据回填 1.表单回填 2.暂存列表  3.更新组件fileList</span></span><br><span class="line"><span class="keyword">const</span> form = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">loadDetail</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> http.<span class="title function_">get</span>(<span class="string">`/mp/articles/<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">    <span class="comment">// 表单数据回填</span></span><br><span class="line">    form.<span class="property">current</span>.<span class="title function_">setFieldsValue</span>(&#123;...res.<span class="property">data</span>, <span class="attr">type</span>: res.<span class="property">data</span>.<span class="property">cover</span>.<span class="property">type</span>&#125;)</span><br><span class="line">    <span class="keyword">const</span> formatImgList = res.<span class="property">data</span>.<span class="property">cover</span>.<span class="property">images</span>.<span class="title function_">map</span>(<span class="function"><span class="params">url</span> =&gt;</span> (&#123;url&#125;))</span><br><span class="line">    <span class="title function_">setFileList</span>(formatImgList)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cachaImgList.current也是一个对象数组，因此也要进行数据处理</span></span><br><span class="line">    cachaImgList.<span class="property">current</span> = formatImgList</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 必须是编辑状态，才可以发送请求</span></span><br><span class="line">  <span class="keyword">if</span>(id)&#123;</span><br><span class="line">    <span class="title function_">loadDetail</span>()</span><br><span class="line">  &#125; </span><br><span class="line">&#125;, [id])</span><br></pre></td></tr></table></figure>

<h2 id="11-编辑保存"><a href="#11-编辑保存" class="headerlink" title="11. 编辑保存"></a>11. 编辑保存</h2><p><code>本节目标:</code> 能够在编辑文章时对文章进行修改</p>
<p><strong>代码实现</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提交表单</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onFinish</span> = <span class="keyword">async</span> (<span class="params">values</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; type, ...rest &#125; = values</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      ...rest,</span><br><span class="line">      <span class="comment">// 注意：接口会按照上传图片数量来决定单图 或 三图</span></span><br><span class="line">      <span class="attr">cover</span>: &#123;</span><br><span class="line">        type,</span><br><span class="line">        <span class="attr">images</span>: fileList.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">url</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(articleId)&#123;</span><br><span class="line">      <span class="comment">// 编辑</span></span><br><span class="line">      <span class="keyword">await</span> http.<span class="title function_">put</span>(<span class="string">`/mp/articles/<span class="subst">$&#123;data.id&#125;</span>?draft=false`</span>,data)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">// 新增</span></span><br><span class="line">      <span class="keyword">await</span> http.<span class="title function_">post</span>(<span class="string">&#x27;/mp/articles?draft=false&#x27;</span>, data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="6-项目打包"><a href="#6-项目打包" class="headerlink" title="6. 项目打包"></a>6. 项目打包</h1><h2 id="1-项目打包"><a href="#1-项目打包" class="headerlink" title="1. 项目打包"></a>1. 项目打包</h2><p><code>本节目标:</code> 能够通过命令对项目进行打包</p>
<p><strong>使用步骤</strong></p>
<ol>
<li><p> 在项目根目录下打开终端，输入打包命令：<code>yarn build</code></p>
</li>
<li><p> 等待打包完成，打包生成的内容被放在根下的build文件夹中</p>
</li>
</ol>
<h2 id="2-项目本地预览"><a href="#2-项目本地预览" class="headerlink" title="2. 项目本地预览"></a>2. 项目本地预览</h2><p><code>本节目标:</code> 能够在本地预览打包后的项目</p>
<p><strong>使用步骤</strong></p>
<ol>
<li><p> 全局安装本地服务包 <code>npm i -g serve</code>  该包提供了serve命令，用来启动本地服务</p>
</li>
<li><p> 在项目根目录中执行命令 <code>serve -s ./build</code>  在build目录中开启服务器</p>
</li>
<li><p> 在浏览器中访问：<code>http://localhost:3000/</code> 预览项目</p>
</li>
</ol>
<h2 id="3-打包体积分析"><a href="#3-打包体积分析" class="headerlink" title="3. 打包体积分析"></a>3. 打包体积分析</h2><p><code>本节目标:</code>   能够分析项目打包体积</p>
<p><strong>分析说明</strong>通过分析打包体积，才能知道项目中的哪部分内容体积过大，才能知道如何来优化</p>
<p><strong>使用步骤</strong></p>
<ol>
<li> 安装分析打包体积的包：<code>yarn add source-map-explorer</code></li>
<li> 在 package.json 中的 scripts 标签中，添加分析打包体积的命令</li>
<li> 对项目打包：<code>yarn build</code>（如果已经打过包，可省略这一步）</li>
<li> 运行分析命令：<code>yarn analyze</code></li>
<li> 通过浏览器打开的页面，分析图表中的包体积</li>
</ol>
<p><strong>核心代码</strong>：</p>
<p>package.json 中：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyze&quot;</span><span class="punctuation">:</span> <span class="string">&quot;source-map-explorer &#x27;build/static/js/*.js&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-优化-配置CDN"><a href="#4-优化-配置CDN" class="headerlink" title="4. 优化-配置CDN"></a>4. 优化-配置CDN</h2><p><code>本节目标:</code>  能够对第三方包使用CDN优化</p>
<p><strong>分析说明</strong>：通过 craco 来修改 webpack 配置，从而实现 CDN 优化</p>
<p><strong>核心代码</strong></p>
<p><code>craco.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加自定义对于webpack的配置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; whenProd, getPlugin, pluginByName &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@craco/craco&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// webpack 配置</span></span><br><span class="line">  <span class="attr">webpack</span>: &#123;</span><br><span class="line">    <span class="comment">// 配置别名</span></span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="comment">// 约定：使用 @ 表示 src 文件所在路径</span></span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 配置webpack</span></span><br><span class="line">    <span class="comment">// 配置CDN</span></span><br><span class="line">    <span class="attr">configure</span>: <span class="function">(<span class="params">webpackConfig</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// webpackConfig自动注入的webpack配置对象</span></span><br><span class="line">      <span class="comment">// 可以在这个函数中对它进行详细的自定义配置</span></span><br><span class="line">      <span class="comment">// 只要最后return出去就行</span></span><br><span class="line">      <span class="keyword">let</span> cdn = &#123;</span><br><span class="line">        <span class="attr">js</span>: [],</span><br><span class="line">        <span class="attr">css</span>: []</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 只有生产环境才配置</span></span><br><span class="line">      <span class="title function_">whenProd</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// key:需要不参与打包的具体的包</span></span><br><span class="line">        <span class="comment">// value: cdn文件中 挂载于全局的变量名称 为了替换之前在开发环境下</span></span><br><span class="line">        <span class="comment">// 通过import 导入的 react / react-dom</span></span><br><span class="line">        webpackConfig.<span class="property">externals</span> = &#123;</span><br><span class="line">          <span class="attr">react</span>: <span class="string">&#x27;React&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;react-dom&#x27;</span>: <span class="string">&#x27;ReactDOM&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 配置现成的cdn 资源数组 现在是公共为了测试</span></span><br><span class="line">        <span class="comment">// 实际开发的时候 用公司自己花钱买的cdn服务器</span></span><br><span class="line">        cdn = &#123;</span><br><span class="line">          <span class="attr">js</span>: [</span><br><span class="line">            <span class="string">&#x27;https://cdnjs.cloudflare.com/ajax/libs/react/18.1.0/umd/react.production.min.js&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.1.0/umd/react-dom.production.min.js&#x27;</span>,</span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">css</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 都是为了将来配置 htmlWebpackPlugin插件 将来在public/index.html注入</span></span><br><span class="line">      <span class="comment">// cdn资源数组时 准备好的一些现成的资源</span></span><br><span class="line">      <span class="keyword">const</span> &#123; isFound, match &#125; = <span class="title function_">getPlugin</span>(</span><br><span class="line">        webpackConfig,</span><br><span class="line">        <span class="title function_">pluginByName</span>(<span class="string">&#x27;HtmlWebpackPlugin&#x27;</span>)</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (isFound) &#123;</span><br><span class="line">        <span class="comment">// 找到了HtmlWebpackPlugin的插件</span></span><br><span class="line">        match.<span class="property">userOptions</span>.<span class="property">cdn</span> = cdn</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> webpackConfig</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>public/index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 加载第三发包的 CDN 链接 --&gt;</span></span><br><span class="line">  &lt;% htmlWebpackPlugin.userOptions.cdn.js.forEach(cdnURL =&gt; &#123; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%= cdnURL %&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  &lt;% &#125;) %&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-优化-路由懒加载"><a href="#5-优化-路由懒加载" class="headerlink" title="5. 优化-路由懒加载"></a>5. 优化-路由懒加载</h2><p><code>本节目标:</code>   能够对路由进行懒加载实现代码分隔</p>
<p><strong>使用步骤</strong></p>
<ol>
<li><p> 在 App 组件中，导入 Suspense 组件</p>
</li>
<li><p> 在 路由Router 内部，使用 Suspense 组件包裹组件内容</p>
</li>
<li><p> 为 Suspense 组件提供 fallback 属性，指定 loading 占位内容</p>
</li>
<li><p> 导入 lazy 函数，并修改为懒加载方式导入路由组件</p>
</li>
</ol>
<p><strong>代码实现</strong></p>
<p><code>App.js</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Routes</span>, <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HistoryRouter</span>, history &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/history&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AuthRoute</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./components/AuthRoute&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入必要组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; lazy, <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="comment">// 按需导入路由组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Login</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/Login&#x27;</span>))</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Layout</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/Layout&#x27;</span>))</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Home</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/Home&#x27;</span>))</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Article</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/Article&#x27;</span>))</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Publish</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/Publish&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span> () &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">HistoryRouter</span> <span class="attr">history</span>=<span class="string">&#123;history&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">fallback</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &lt;<span class="attr">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">textAlign:</span> &#x27;<span class="attr">center</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">marginTop:</span> <span class="attr">200</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span></span></span><br><span class="line"><span class="language-xml">            loading...</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;/* 需要鉴权的路由 */&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &lt;<span class="attr">AuthRoute</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Layout</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">AuthRoute</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#125;&gt;</span></span><br><span class="line"><span class="language-xml">            &#123;/* 二级路由默认页面 */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">index</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Home</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;article&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Article</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;publish&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Publish</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;/* 不需要鉴权的路由 */&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/login&#x27;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Login</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">HistoryRouter</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>

<p><strong>查看效果</strong></p>
<p>我们可以在打包之后，通过切换路由，监控network面板资源的请求情况，验证是否分隔成功</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">pupu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/06/06/React%E7%AE%80%E5%8D%95pc%E9%A1%B9%E7%9B%AE/">http://example.com/2023/06/06/React%E7%AE%80%E5%8D%95pc%E9%A1%B9%E7%9B%AE/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">pupu's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/React/">React</a></div><div class="post_share"><div class="social-share" data-image="/img/img.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/06/11/Ajax%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Ajax学习笔记"><img class="cover" src="/img/img.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Ajax学习笔记</div></div></a></div><div class="next-post pull-right"><a href="/2023/05/16/React%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="React基础学习笔记"><img class="cover" src="/img/img.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">React基础学习笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/05/16/React%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="React基础学习笔记"><img class="cover" src="/img/img.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-16</div><div class="title">React基础学习笔记</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">pupu</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/pupu22"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87"><span class="toc-number">1.</span> <span class="toc-text">1. 项目前置准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">1. 项目介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%8A%9F%E8%83%BD%E6%BC%94%E7%A4%BA"><span class="toc-number">1.1.1.</span> <span class="toc-text">项目功能演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF"><span class="toc-number">1.1.2.</span> <span class="toc-text">技术</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8scss%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">1.2.</span> <span class="toc-text">4. 使用scss预处理器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%85%8D%E7%BD%AE%E5%9F%BA%E7%A1%80%E8%B7%AF%E7%94%B1"><span class="toc-number">1.3.</span> <span class="toc-text">5. 配置基础路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E7%BB%84%E4%BB%B6%E5%BA%93antd%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.</span> <span class="toc-text">6. 组件库antd使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.1.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#antd%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%BB%E9%A2%98%E8%89%B2"><span class="toc-number">1.4.2.</span> <span class="toc-text">antd如何使用自己的主题色</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E9%85%8D%E7%BD%AE%E5%88%AB%E5%90%8D%E8%B7%AF%E5%BE%84"><span class="toc-number">1.5.</span> <span class="toc-text">7. 配置别名路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%88%AB%E5%90%8D%E8%B7%AF%E5%BE%84%E6%8F%90%E7%A4%BA"><span class="toc-number">1.6.</span> <span class="toc-text">8. @别名路径提示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%AE%89%E8%A3%85dev-tools%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="toc-number">1.7.</span> <span class="toc-text">9. 安装dev-tools调试工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97"><span class="toc-number">2.</span> <span class="toc-text">2. 登录模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84%E6%90%AD%E5%BB%BA"><span class="toc-number">2.1.</span> <span class="toc-text">1. 基本结构搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E8%A1%A8%E5%8D%95%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.</span> <span class="toc-text">2. 创建表单结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.3.</span> <span class="toc-text">3. 表单校验实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%8E%B7%E5%8F%96%E7%99%BB%E5%BD%95%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="toc-number">2.4.</span> <span class="toc-text">4. 获取登录表单数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%B0%81%E8%A3%85http%E5%B7%A5%E5%85%B7%E6%A8%A1%E5%9D%97"><span class="toc-number">2.5.</span> <span class="toc-text">5. 封装http工具模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E9%85%8D%E7%BD%AE%E7%99%BB%E5%BD%95Mobx"><span class="toc-number">2.6.</span> <span class="toc-text">6. 配置登录Mobx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91"><span class="toc-number">2.7.</span> <span class="toc-text">7. 实现登录逻辑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-token%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">2.8.</span> <span class="toc-text">8. token持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0"><span class="toc-number">2.8.1.</span> <span class="toc-text">封装工具函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.8.2.</span> <span class="toc-text">持久化设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E8%AF%B7%E6%B1%82%E6%8B%A6%E6%88%AA%E5%99%A8%E6%B3%A8%E5%85%A5token"><span class="toc-number">2.9.</span> <span class="toc-text">9. 请求拦截器注入token</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E8%B7%AF%E7%94%B1%E9%89%B4%E6%9D%83%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.10.</span> <span class="toc-text">10. 路由鉴权实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6"><span class="toc-number">2.10.1.</span> <span class="toc-text">高阶组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-1"><span class="toc-number">2.10.2.</span> <span class="toc-text">问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Layout%E6%A8%A1%E5%9D%97"><span class="toc-number">3.</span> <span class="toc-text">3. Layout模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84%E6%90%AD%E5%BB%BA-1"><span class="toc-number">3.1.</span> <span class="toc-text">1. 基本结构搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BA%8C%E7%BA%A7%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">2. 二级路由配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%8F%9C%E5%8D%95%E9%AB%98%E4%BA%AE%E6%98%BE%E7%A4%BA"><span class="toc-number">3.3.</span> <span class="toc-text">3. 菜单高亮显示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%B1%95%E7%A4%BA%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">3.4.</span> <span class="toc-text">4. 展示个人信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-2"><span class="toc-number">3.4.1.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.5.</span> <span class="toc-text">5. 退出登录实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%A4%84%E7%90%86Token%E5%A4%B1%E6%95%88"><span class="toc-number">3.6.</span> <span class="toc-text">6. 处理Token失效</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-3"><span class="toc-number">3.6.0.1.</span> <span class="toc-text">问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E9%A6%96%E9%A1%B5Home%E5%9B%BE%E8%A1%A8%E5%B1%95%E7%A4%BA"><span class="toc-number">3.7.</span> <span class="toc-text">7. 首页Home图表展示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E6%96%87%E7%AB%A0%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">4.</span> <span class="toc-text">4. 文章管理模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%AD%9B%E9%80%89%E5%8C%BA%E7%BB%93%E6%9E%84"><span class="toc-number">4.1.</span> <span class="toc-text">1. 筛选区结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-4"><span class="toc-number">4.1.1.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%A1%A8%E6%A0%BC%E5%8C%BA%E5%9F%9F%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.</span> <span class="toc-text">2. 表格区域结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-5"><span class="toc-number">4.2.1.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%B8%B2%E6%9F%93%E9%A2%91%E9%81%93%E6%95%B0%E6%8D%AE"><span class="toc-number">4.3.</span> <span class="toc-text">3. 渲染频道数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%B8%B2%E6%9F%93%E8%A1%A8%E6%A0%BC%E6%95%B0%E6%8D%AE"><span class="toc-number">4.4.</span> <span class="toc-text">4. 渲染表格数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%AD%9B%E9%80%89%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.5.</span> <span class="toc-text">5. 筛选功能实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%88%86%E9%A1%B5%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.6.</span> <span class="toc-text">6. 分页功能实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-6"><span class="toc-number">4.6.1.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-useState%E4%B8%8EuseEffect%E7%9A%84%E6%8B%86%E5%88%86%E7%B2%92%E5%BA%A6"><span class="toc-number">4.7.</span> <span class="toc-text">6.5 useState与useEffect的拆分粒度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD"><span class="toc-number">4.8.</span> <span class="toc-text">7. 删除功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E7%BC%96%E8%BE%91%E6%96%87%E7%AB%A0%E8%B7%B3%E8%BD%AC"><span class="toc-number">4.9.</span> <span class="toc-text">8. 编辑文章跳转</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E6%A8%A1%E5%9D%97"><span class="toc-number">5.</span> <span class="toc-text">5. 发布文章模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84%E6%90%AD%E5%BB%BA-2"><span class="toc-number">5.1.</span> <span class="toc-text">1. 基本结构搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8"><span class="toc-number">5.2.</span> <span class="toc-text">2. 富文本编辑器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E9%A2%91%E9%81%93%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"><span class="toc-number">5.3.</span> <span class="toc-text">3. 频道数据获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%B8%8A%E4%BC%A0%E5%B0%81%E9%9D%A2%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.4.</span> <span class="toc-text">4. 上传封面实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%88%87%E6%8D%A2%E5%9B%BE%E7%89%87Type"><span class="toc-number">5.5.</span> <span class="toc-text">5.切换图片Type</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%8E%A7%E5%88%B6%E6%9C%80%E5%A4%A7%E4%B8%8A%E4%BC%A0%E6%95%B0%E9%87%8F"><span class="toc-number">5.6.</span> <span class="toc-text">6. 控制最大上传数量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%9A%82%E5%AD%98%E5%9B%BE%E7%89%87%E5%88%97%E8%A1%A8%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.7.</span> <span class="toc-text">7. 暂存图片列表实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.8.</span> <span class="toc-text">8. 发布文章实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E7%BC%96%E8%BE%91%E6%96%87%E7%AB%A0-%E6%96%87%E6%A1%88%E9%80%82%E9%85%8D"><span class="toc-number">5.9.</span> <span class="toc-text">9. 编辑文章-文案适配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E7%BC%96%E8%BE%91%E6%96%87%E7%AB%A0-%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"><span class="toc-number">5.10.</span> <span class="toc-text">10.编辑文章-数据获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E7%BC%96%E8%BE%91%E6%96%87%E7%AB%A0-%E5%9B%9E%E6%98%BEForm"><span class="toc-number">5.11.</span> <span class="toc-text">11. 编辑文章-回显Form</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E7%BC%96%E8%BE%91%E6%96%87%E7%AB%A0-%E5%9B%9E%E6%98%BEUpload%E7%9B%B8%E5%85%B3"><span class="toc-number">5.12.</span> <span class="toc-text">12. 编辑文章-回显Upload相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E7%BC%96%E8%BE%91%E4%BF%9D%E5%AD%98"><span class="toc-number">5.13.</span> <span class="toc-text">11. 编辑保存</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85"><span class="toc-number">6.</span> <span class="toc-text">6. 项目打包</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85"><span class="toc-number">6.1.</span> <span class="toc-text">1. 项目打包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%A1%B9%E7%9B%AE%E6%9C%AC%E5%9C%B0%E9%A2%84%E8%A7%88"><span class="toc-number">6.2.</span> <span class="toc-text">2. 项目本地预览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%89%93%E5%8C%85%E4%BD%93%E7%A7%AF%E5%88%86%E6%9E%90"><span class="toc-number">6.3.</span> <span class="toc-text">3. 打包体积分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BC%98%E5%8C%96-%E9%85%8D%E7%BD%AECDN"><span class="toc-number">6.4.</span> <span class="toc-text">4. 优化-配置CDN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BC%98%E5%8C%96-%E8%B7%AF%E7%94%B1%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-number">6.5.</span> <span class="toc-text">5. 优化-路由懒加载</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/11/Ajax%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Ajax学习笔记">Ajax学习笔记</a><time datetime="2023-06-11T10:53:26.000Z" title="发表于 2023-06-11 18:53:26">2023-06-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/06/React%E7%AE%80%E5%8D%95pc%E9%A1%B9%E7%9B%AE/" title="React简单pc项目">React简单pc项目</a><time datetime="2023-06-06T11:40:27.000Z" title="发表于 2023-06-06 19:40:27">2023-06-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/16/React%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="React基础学习笔记">React基础学习笔记</a><time datetime="2023-05-16T09:36:36.000Z" title="发表于 2023-05-16 17:36:36">2023-05-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/11/JavaScript%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="JavaScript从入门到进阶学习笔记">JavaScript从入门到进阶学习笔记</a><time datetime="2023-05-11T07:41:26.000Z" title="发表于 2023-05-11 15:41:26">2023-05-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/05/05/web%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/" title="笔记：web前端HTML + CSS 开发入门">笔记：web前端HTML + CSS 开发入门</a><time datetime="2023-05-05T12:27:56.000Z" title="发表于 2023-05-05 20:27:56">2023-05-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By pupu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>